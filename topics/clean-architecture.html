<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Architecture äº’å‹•å­¸ç¿’</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
<link rel="stylesheet" href="../core/engine.css">
<script src="../core/theme.js"></script>
<style>
/* Topic-specific: Dependency diagram */
.dep-diagram{display:flex;justify-content:center;align-items:center;gap:0;margin:24px 0;flex-wrap:wrap}
.dep-layer{padding:16px 24px;border-radius:var(--rs);font-weight:600;font-size:.85rem;text-align:center;min-width:140px;position:relative}
.dep-arrow{font-size:1.4rem;color:var(--lav);animation:pulse 2s infinite;margin:0 4px}
@keyframes arrowFlow{0%,100%{opacity:.3}50%{opacity:1}}
.dep-outer{background:#fce4ec;color:#c62828;border:2px solid #ef9a9a}
.dep-mid{background:#e3f2fd;color:#1565c0;border:2px solid #90caf9}
.dep-inner{background:#e8f5e9;color:#2e7d32;border:2px solid #a5d6a7}
[data-theme="dark"] .dep-outer{background:#4a2030;color:#f48fb1;border-color:#c62828}
[data-theme="dark"] .dep-mid{background:#1a3050;color:#90caf9;border-color:#42a5f5}
[data-theme="dark"] .dep-inner{background:#1a3a1a;color:#a5d6a7;border-color:#66bb6a}
.layer-label-green{color:#2e7d32}
.layer-label-blue{color:#1565c0}
.layer-label-red{color:#c62828}
[data-theme="dark"] .layer-label-green{color:#a5d6a7}
[data-theme="dark"] .layer-label-blue{color:#90caf9}
[data-theme="dark"] .layer-label-red{color:#f48fb1}
.layer-box{padding:16px;border-radius:var(--rs);text-align:center;border-width:2px;border-style:solid}
.layer-box-green{background:#e8f5e9;border-color:#a5d6a7}
.layer-box-orange{background:#fff3e0;border-color:#ffcc80}
.layer-box-blue{background:#e3f2fd;border-color:#90caf9}
.layer-box-red{background:#fce4ec;border-color:#ef9a9a}
[data-theme="dark"] .layer-box-green{background:#1a3a1a;border-color:#66bb6a}
[data-theme="dark"] .layer-box-orange{background:#3a2a10;border-color:#ffb74d}
[data-theme="dark"] .layer-box-blue{background:#1a3050;border-color:#42a5f5}
[data-theme="dark"] .layer-box-red{background:#4a2030;border-color:#c62828}
.cmp-row-summary{background:var(--bg-sec)}
@media(max-width:768px){
  .dep-diagram{flex-direction:column;gap:8px}
  .dep-arrow{transform:rotate(90deg)}
}
</style>
</head>
<body>

<div class="opening" id="opening">
  <div class="opening-box">
    <div style="font-size:3rem;margin-bottom:16px">ğŸ›ï¸</div>
    <h1>æ¶æ§‹å®ˆè­·è€…</h1>
    <p class="sub">ä½ å³å°‡æˆç‚ºåœ˜éšŠçš„æ¶æ§‹å®ˆè­·è€…ã€‚<br>æ¯ä¸€å±¤çš„è¨­è¨ˆæ±ºç­–ï¼Œéƒ½å°‡ç”±ä½ å‘ä¸»ç®¡èªªæ˜ã€‚<br><br>é€é 7 å€‹ç« ç¯€çš„äº’å‹•å­¸ç¿’ï¼Œ<br>å¾ SOLID åŸå‰‡åˆ°è²»æ›¼é©—è­‰ï¼Œæˆç‚ºçœŸæ­£çš„æ¶æ§‹å¸«ã€‚</p>
    <button class="btn-start" onclick="startJourney()">é–‹å§‹æ—…ç¨‹</button>
  </div>
</div>

<header class="topbar" id="topbar">
  <button class="hamburger" onclick="toggleSidebar()" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>
  <div class="logo">ğŸ› Clean Architecture</div>
  <div class="progress-wrap"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
  <div class="xp-badge">âš¡ <span class="num" id="xp-num">0</span> XP</div>
  <div class="streak-tag" id="streak-tag" style="display:none"></div>
  <div class="badge-row" id="badge-row"></div>
</header>

<nav class="sidebar" id="sidebar"></nav>
<main class="main" id="main-content"></main>
<div class="toast-wrap" id="toast-wrap"></div>

<script src="../core/trainer.js" onerror="document.getElementById('main-content').innerHTML='<div style=\'padding:40px;text-align:center;color:#c44\'>è¼‰å…¥å¤±æ•—ï¼štrainer.js ç„¡æ³•è¼‰å…¥ã€‚è«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚</div>'"></script>
<script src="../core/engine.js" onerror="document.getElementById('main-content').innerHTML='<div style=\'padding:40px;text-align:center;color:#c44\'>è¼‰å…¥å¤±æ•—ï¼šengine.js ç„¡æ³•è¼‰å…¥ã€‚è«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚</div>'"></script>
<script>
// ============================================================
// TOPIC CONFIG
// ============================================================
var TOPIC_CONFIG = {
  id: 'ca-learn',
  legacyKeys: ['ca-learn'],
  totalXP: 950,
  hlKeywords: 'class|data|fun|val|var|suspend|operator|sealed|interface|import|package|override|private|return|if|else|when|object|open|abstract|is|in|internal|enum|null|true|false|by|inline|typealias|out',
  hlTypes: 'String|Int|Double|Boolean|List|Flow|Result|Unit|Long|CoinDataSource|Coin|CoinPrice|CoinDto|CoinPriceDto|NetworkError|CoinUi|CoinListState|DisplayableNumber|HttpClient|ZonedDateTime|Error|DomainError',
  parts: [
    {id:1, title:'SOLID åŸå‰‡', sub:'Clean Architecture çš„åœ°åŸº', icon:'ğŸ§±', xpRead:50, xpQuiz:50},
    {id:2, title:'Dependency Rule', sub:'Clean Architecture çš„éˆé­‚', icon:'â¡ï¸', xpRead:50, xpQuiz:50},
    {id:3, title:'åŒå¿ƒåœ“æ˜ å°„', sub:'å››å±¤â†’ä¸‰å±¤çš„å°æ‡‰é—œä¿‚', icon:'ğŸ—ºï¸', xpRead:50, xpQuiz:50},
    {id:4, title:'é€å±¤å¯¦æˆ°èµ°è®€', sub:'10 æ­¥è³‡æ–™æµå®Œæ•´è¿½è¹¤', icon:'ğŸ“–', xpRead:50, xpQuiz:50},
    {id:5, title:'YT Dev vs Google NIA', sub:'å…©å¤§æµæ´¾æ·±åº¦æ¯”è¼ƒ', icon:'âš–ï¸', xpRead:50, xpQuiz:50},
    {id:6, title:'å‹•æ‰‹ç·´ç¿’', sub:'åŠ å…¥ Use Case å±¤', icon:'ğŸ› ï¸', xpRead:0, xpQuiz:200},
    {id:7, title:'è²»æ›¼é©—è­‰', sub:'ç”¨è‡ªå·±çš„è©±è§£é‡‹æ¶æ§‹', icon:'ğŸ“', xpRead:0, xpQuiz:150}
  ],
  badges: [
    {id:'solid', name:'SOLID åŸºçŸ³', icon:'ğŸ§±', req:[1]},
    {id:'dep', name:'ä¾è³´è¿½è¹¤è€…', icon:'â¡ï¸', req:[2]},
    {id:'map', name:'æ¶æ§‹è£½åœ–å¸«', icon:'ğŸ—ºï¸', req:[3,4]},
    {id:'judge', name:'æµæ´¾é‘‘å®šå¸«', icon:'âš–ï¸', req:[5]},
    {id:'craft', name:'Use Case å·¥åŒ ', icon:'ğŸ› ï¸', req:[6]},
    {id:'master', name:'æ¶æ§‹å¸«', icon:'ğŸ“', req:[1,2,3,4,5,6,7]}
  ],
  defaultStateExtra: {
    part1Matches: {},
    part2Answers: [null, null, null, null],
    part3Answer: null,
    part4Order: null,
    part5Answer: null,
    part6Code: '',
    part7Answers: ['', '', '', ''],
    part7Ratings: [0, 0, 0, 0]
  },
  initExtra: function() {
    document.addEventListener('input', function(e) {
      if (e.target.id === 'part6-editor') { S.part6Code = e.target.value; save(); }
      if (e.target.classList.contains('feynman-ta')) {
        var idx = parseInt(e.target.id.split('-')[1]);
        S.part7Answers[idx] = e.target.value; save();
      }
    });
  }
};

// ============================================================
// PART 1: SOLID åŸå‰‡
// ============================================================
function getPart1() {
  var done = S.completedParts.includes(1);
  var read = S.readParts.includes(1);
  var solidData = [
    {letter:'S', name:'Single Responsibility Principle', zh:'å–®ä¸€è·è²¬åŸå‰‡',
     desc:'æ¯å€‹é¡åˆ¥åªæœ‰ä¸€å€‹æ”¹è®Šçš„ç†ç”±ã€‚<code>Coin.kt</code> åªå› æ¥­å‹™æ¬„ä½è®Šæ›´è€Œæ”¹ï¼Œ<code>CoinDto.kt</code> åªå›  API æ ¼å¼è®Šæ›´è€Œæ”¹ï¼Œ<code>CoinMapper.kt</code> åªå› è½‰æ›é‚è¼¯è®Šæ›´è€Œæ”¹ã€‚',
     code:'// Domain å±¤ - ç´”ç²¹çš„æ¥­å‹™æ¨¡å‹\ndata class Coin(\n    val id: String,\n    val rank: Int,\n    val name: String,\n    val symbol: String,\n    val marketCapUsd: Double,\n    val priceUsd: Double,\n    val changePercent24Hr: Double,\n)\n\n// Data å±¤ - å°æ‡‰ API JSON\nimport kotlinx.serialization.Serializable\n\n@Serializable\ndata class CoinDto(\n    val id: String,\n    val rank: Int,\n    val name: String,\n    // ... å¸¶æœ‰åºåˆ—åŒ–æ¨™è¨˜\n)'},
    {letter:'O', name:'Open/Closed Principle', zh:'é–‹æ”¾å°é–‰åŸå‰‡',
     desc:'å°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹å°é–‰ã€‚<code>Result&lt;D, E&gt;</code> æ˜¯ sealed interface â€” ç›®å‰æœ‰ <code>Success</code> å’Œ <code>Error</code>ï¼Œæœªä¾†è¦åŠ  <code>Loading</code> åªéœ€æ–°å¢å­é¡åˆ¥ï¼Œä¸ç”¨æ”¹ç¾æœ‰ç¨‹å¼ç¢¼ã€‚',
     code:'typealias DomainError = Error\n\nsealed interface Result<out D, out E: Error> {\n    data class Success<out D>(val data: D): Result<D, Nothing>\n    data class Error<out E: DomainError>(val error: E): Result<Nothing, E>\n}'},
    {letter:'L', name:'Liskov Substitution Principle', zh:'é‡Œæ°æ›¿æ›åŸå‰‡',
     desc:'å­å‹åˆ¥å¿…é ˆå¯ä»¥æ›¿æ›çˆ¶å‹åˆ¥ã€‚<code>RemoteCoinDataSource</code> å¯¦ä½œ <code>CoinDataSource</code> ä»‹é¢ï¼ŒViewModel é€éä»‹é¢å‘¼å« â€” å¯ä»¥ç„¡ç¸«æ›¿æ›ç‚º <code>LocalCoinDataSource</code> æˆ– <code>FakeCoinDataSource</code>ã€‚',
     code:'// ViewModel åªèªä»‹é¢\nclass CoinListViewModel(\n    private val coinDataSource: CoinDataSource  // ä»‹é¢\n) : ViewModel()\n\n// DI åœ¨åŸ·è¡Œæ™‚ç¶å®šå…·é«”å¯¦ä½œ\nsingleOf(::RemoteCoinDataSource).bind<CoinDataSource>()'},
    {letter:'I', name:'Interface Segregation Principle', zh:'ä»‹é¢éš”é›¢åŸå‰‡',
     desc:'ä¸è¦å¼·è¿«å®¢æˆ¶ç«¯ä¾è³´å®ƒä¸éœ€è¦çš„æ–¹æ³•ã€‚<code>Error</code> æ˜¯ç©ºçš„æ¨™è¨˜ä»‹é¢ï¼Œ<code>NetworkError</code> ç¹¼æ‰¿å®ƒä½†åªå®šç¾©ç¶²è·¯ç›¸é—œçš„éŒ¯èª¤ï¼Œä¸è¢«è¿«å¯¦ä½œä¸ç›¸é—œçš„æ–¹æ³•ã€‚',
     code:'interface Error  // ç©ºæ¨™è¨˜ä»‹é¢\n\nenum class NetworkError: Error {\n    REQUEST_TIMEOUT,\n    TOO_MANY_REQUESTS,\n    NO_INTERNET,\n    SERVER_ERROR,\n    SERIALIZATION,\n    UNKNOWN,\n}'},
    {letter:'D', name:'Dependency Inversion Principle', zh:'ä¾è³´åè½‰åŸå‰‡',
     desc:'é«˜å±¤æ¨¡çµ„å®šç¾©ä»‹é¢ï¼ˆå¥‘ç´„ï¼‰ï¼Œä½å±¤æ¨¡çµ„è² è²¬å¯¦ä½œã€‚<code>CoinDataSource</code> ä»‹é¢å®šç¾©åœ¨ Domain å±¤ï¼ˆé«˜å±¤ï¼‰ï¼Œ<code>RemoteCoinDataSource</code> åœ¨ Data å±¤ï¼ˆä½å±¤ï¼‰å¯¦ä½œã€‚',
     code:'// Domain å±¤å®šç¾©ã€Œæˆ‘éœ€è¦ä»€éº¼ã€\ninterface CoinDataSource {\n    suspend fun getCoins(): Result<List<Coin>, NetworkError>\n    suspend fun getCoinHistory(\n        coinId: String,\n        start: ZonedDateTime,\n        end: ZonedDateTime\n    ): Result<List<CoinPrice>, NetworkError>\n}\n\n// Data å±¤å¯¦ä½œã€Œæ€éº¼åšåˆ°ã€\nclass RemoteCoinDataSource(\n    private val httpClient: HttpClient\n): CoinDataSource { ... }'}
  ];

  var html = '<div class="part-hdr"><span class="tag">Part 1</span><h1>ğŸ§± SOLID åŸå‰‡ â€” Clean Architecture çš„åœ°åŸº</h1>' +
    '<p class="desc">Clean Architecture å»ºç«‹åœ¨ SOLID åŸå‰‡ä¹‹ä¸Šã€‚ä»¥ CryptoTracker çš„å¯¦éš›ç¨‹å¼ç¢¼ï¼Œé€ä¸€ç†è§£æ¯å€‹åŸå‰‡å¦‚ä½•è¢«å¯¦è¸ã€‚</p></div>';

  solidData.forEach(function(s) {
    html += '<div class="accordion"><button class="acc-head" onclick="toggleAcc(this)">' +
      '<span><strong style="color:var(--lav)">' + s.letter + '</strong> â€” ' + s.zh + 'ï¼ˆ' + s.name + 'ï¼‰</span>' +
      '<span class="arrow">â–¼</span></button>' +
      '<div class="acc-body"><div class="acc-inner"><p>' + s.desc + '</p>' + codeBlock(s.code) + '</div></div></div>';
  });

  html += insightBlock(1, 'SOLID ä¸æ˜¯ Clean Architecture çš„å…¨éƒ¨ï¼Œä½†é•å SOLID çš„æ¶æ§‹ä¸€å®šä¸ Cleanã€‚Robert C. Martin æ­£æ˜¯ SOLID çš„æå‡ºè€…ï¼Œæ‰€ä»¥ Clean Architecture æ˜¯ SOLID åŸå‰‡çš„ç³»çµ±æ€§æ‡‰ç”¨â€”â€”å¾é¡åˆ¥å±¤ç´šæ¨å»£åˆ°ç³»çµ±å±¤ç´šã€‚');

  if (!read) html += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(1)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else html += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  html += getQuiz1HTML(done);

  html += briefCard(1, 'SOLID åŸå‰‡', [
    'æˆ‘å€‘çš„å°ˆæ¡ˆéµå¾ª SOLID åŸå‰‡ï¼Œæ¯å€‹æª”æ¡ˆæœ‰æ¸…æ¥šçš„å–®ä¸€è·è²¬ï¼ˆCoin vs CoinDto vs CoinMapperï¼‰ï¼Œé™ä½ä¿®æ”¹é¢¨éšª',
    'é€é sealed interfaceï¼ˆResultï¼‰å’Œä»‹é¢æŠ½è±¡ï¼ˆCoinDataSourceï¼‰ï¼Œç³»çµ±å°æ“´å±•é–‹æ”¾ã€å°ä¿®æ”¹å°é–‰',
    'æœ€é—œéµçš„æ˜¯ä¾è³´åè½‰â€”â€”Domain å±¤å®šç¾©ä»‹é¢ï¼ŒData å±¤å¯¦ä½œï¼Œæ ¸å¿ƒæ¥­å‹™é‚è¼¯ä¸å—æŠ€è¡“ç´°ç¯€ç¶æ¶'
  ], 'ç‚ºä»€éº¼ Coin å’Œ CoinDto é•·å¾—å¹¾ä¹ä¸€æ¨£é‚„è¦åˆ†é–‹ï¼Ÿ', 'å› ç‚ºå®ƒå€‘çš„è®Šæ›´åŸå› ä¸åŒã€‚API æ ¼å¼è®Šäº†åªæ”¹ CoinDtoï¼Œæ¥­å‹™éœ€æ±‚è®Šäº†åªæ”¹ Coinï¼Œé€™å°±æ˜¯å–®ä¸€è·è²¬åŸå‰‡çš„åƒ¹å€¼ã€‚');

  return html;
}

function getQuiz1HTML(done) {
  var descs = ['Coin.kt å’Œ CoinDto.kt åˆ†é–‹ï¼Œå„æœ‰å–®ä¸€è·è²¬', 'Result sealed interface å¯æ“´å±•è€Œä¸æ”¹ç¾æœ‰ç¨‹å¼ç¢¼',
    'RemoteCoinDataSource å¯æ›¿æ›ä»»ä½• CoinDataSource', 'Error æ¨™è¨˜ä»‹é¢ä¸å¼·è¿«å¯¦ä½œä¸ç›¸é—œæ–¹æ³•', 'CoinDataSource ä»‹é¢å®šç¾©åœ¨ Domain å±¤ï¼ˆé«˜å±¤ï¼‰'];
  var letters = ['S', 'O', 'L', 'I', 'D'];

  var h = '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šSOLID é…å°</h3><p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">å°‡æ¯å€‹ SOLID å­—æ¯é…å°åˆ°æ­£ç¢ºçš„ CryptoTracker æ¦‚å¿µ</p>';
  letters.forEach(function(l) {
    var sel = S.part1Matches[l];
    h += '<div class="quiz-row"><span class="quiz-tag" style="font-weight:700;background:var(--lav);color:#fff;cursor:default">' + l + '</span>' +
      '<select class="quiz-select" onchange="setPart1Match(\'' + l + '\',this.value)"' + (done ? ' disabled' : '') + '><option value="">â€” é¸æ“‡é…å° â€”</option>';
    descs.forEach(function(d, i) { h += '<option value="' + i + '"' + (sel == i ? ' selected' : '') + '>' + d + '</option>'; });
    h += '</select></div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz1()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz1-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼æ‰€æœ‰é…å°æ­£ç¢ºã€‚</div>';
  h += '</div>';
  return h;
}
function setPart1Match(l, v) { S.part1Matches[l] = v === '' ? null : parseInt(v); save(); }
function checkQuiz1() {
  var correct = {S:0, O:1, L:2, I:3, D:4};
  var ok = Object.keys(correct).every(function(l) { return S.part1Matches[l] === correct[l]; });
  var el = document.getElementById('quiz1-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨æ­£ç¢ºï¼</div>'; completePart(1); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ æœ‰äº›é…å°ä¸æ­£ç¢ºï¼Œå†æƒ³æƒ³çœ‹ï¼</div>';
}

// ============================================================
// PART 2: Dependency Rule
// ============================================================
function getPart2() {
  var done = S.completedParts.includes(2), read = S.readParts.includes(2);
  var h = '<div class="part-hdr"><span class="tag">Part 2</span><h1>â¡ï¸ Dependency Rule â€” Clean Architecture çš„éˆé­‚</h1>' +
    '<p class="desc">ã€ŒClean Architecture å¯ä»¥åªç”¨ä¸€æ¢è¦å‰‡ä¾†ç¸½çµâ€”â€”The Dependency Ruleã€‚ã€æ‰€æœ‰åŸå§‹ç¢¼ä¾è³´æ–¹å‘å¿…é ˆåªèƒ½æŒ‡å‘å…§éƒ¨ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:16px">ä¾è³´æ–¹å‘åœ–</h3>' +
    '<div class="dep-diagram">' +
    '<div class="dep-layer dep-outer">Presentation å±¤<div style="font-size:.75rem;margin-top:4px">CoinListViewModel</div></div>' +
    '<div class="dep-arrow">â†’</div>' +
    '<div class="dep-layer dep-inner" style="border-width:3px">Domain å±¤ï¼ˆæ ¸å¿ƒï¼‰<div style="font-size:.75rem;margin-top:4px">Coin, CoinDataSource</div></div>' +
    '<div class="dep-arrow">â†</div>' +
    '<div class="dep-layer dep-mid">Data å±¤<div style="font-size:.75rem;margin-top:4px">RemoteCoinDataSource</div></div>' +
    '</div>' +
    '<p style="text-align:center;color:var(--txt2);font-size:.85rem;margin-top:12px">ç®­é ­æ–¹å‘ = import ä¾è³´æ–¹å‘ï¼Œæ°¸é æŒ‡å‘ Domain æ ¸å¿ƒ</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">è­‰æ“šï¼šè¿½è¹¤æ¯å€‹æª”æ¡ˆçš„ import</h3>';
  h += '<div style="margin-bottom:16px"><strong class="layer-label-green">Domain å±¤ï¼ˆé›¶å¤–éƒ¨ä¾è³´ï¼‰</strong>' +
    codeBlock('// Coin.kt â€” å®Œå…¨æ²’æœ‰ importï¼\ndata class Coin(\n    val id: String,\n    val rank: Int,\n    ...  // å…¨éƒ¨å±¬æ€§éƒ½åœ¨ domain å±¤ï¼Œé›¶ä¾è³´\n)\n\n// CoinDataSource.kt â€” åª import Domain è‡ªå·±çš„å‹åˆ¥\nimport com.plcoding.cryptotracker.core.domain.util.NetworkError\nimport com.plcoding.cryptotracker.core.domain.util.Result\nimport java.time.ZonedDateTime') + '</div>';
  h += '<div style="margin-bottom:16px"><strong class="layer-label-blue">Data å±¤ï¼ˆä¾è³´ Domain âœ… ä¸ä¾è³´ Presentation âœ…ï¼‰</strong>' +
    codeBlock('// RemoteCoinDataSource.kt çš„ import\nimport com.plcoding.cryptotracker.core.domain.util.Result      // â†’ Domain âœ…\nimport com.plcoding.cryptotracker.core.domain.util.map         // â†’ Domain âœ…\nimport com.plcoding.cryptotracker.crypto.domain.Coin           // â†’ Domain âœ…\nimport com.plcoding.cryptotracker.crypto.domain.CoinDataSource // â†’ Domain âœ…\nimport com.plcoding.cryptotracker.crypto.data.mappers.toCoin   // â†’ åŒå±¤ Data âœ…\n// æ²’æœ‰ä»»ä½• crypto.presentation.* çš„ import âœ…') + '</div>';
  h += '<div><strong class="layer-label-red">Presentation å±¤ï¼ˆä¾è³´ Domain âœ… ä¸ä¾è³´ Data âœ…ï¼‰</strong>' +
    codeBlock('// CoinListViewModel.kt\nimport com.plcoding.cryptotracker.crypto.domain.CoinDataSource // â†’ Domain ä»‹é¢ âœ…\n// ä¸æ˜¯ import RemoteCoinDataSourceï¼ˆData å±¤ï¼‰') + '</div></div>';

  h += insightBlock(2, 'Dependency Rule çš„å¨åŠ›ï¼šç•¶ä½ éœ€è¦æ›¿æ›è³‡æ–™åº«ï¼ˆå¦‚å¾ Room æ›æˆ DataStoreï¼‰ï¼Œåªè¦æ–°çš„å¯¦ä½œéµå®ˆ CoinDataSource ä»‹é¢ï¼ŒDomain å±¤å’Œ Presentation å±¤å®Œå…¨ä¸ç”¨å‹•ã€‚é€™å°±æ˜¯ã€Œç©©å®šæ€§åŸå‰‡ã€â€”â€”è¶Šå…§å±¤è¶Šç©©å®šï¼Œè¶Šä¸å¸¸æ”¹è®Šã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(2)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var tfQ = [
    {code:'CoinListViewModel import CoinDataSource', ans:true, explain:'Presentation â†’ Domainï¼Œåˆæ³•'},
    {code:'Coin.kt import @Serializable', ans:false, explain:'Domain ä¸è©²ä¾è³´åºåˆ—åŒ–æ¡†æ¶'},
    {code:'CoinMapper import CoinDto å’Œ Coin', ans:true, explain:'Data å±¤å¯ä»¥ä¾è³´ Domain å±¤'},
    {code:'CoinDataSource import RemoteCoinDataSource', ans:false, explain:'Domain ä¸å¯ä¾è³´ Data å±¤'}
  ];
  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šåˆ¤æ–· import æ˜¯å¦åˆæ³•</h3>';
  tfQ.forEach(function(q, i) {
    var a = S.part2Answers[i];
    h += '<div class="tf-row"><code class="tf-code">' + q.code + '</code><div class="tf-btns">' +
      '<button class="tf-btn' + (a === true ? ' sel-t' : '') + '" onclick="setPart2(' + i + ',true)"' + (done ? ' disabled' : '') + '>âœ… åˆæ³•</button>' +
      '<button class="tf-btn' + (a === false ? ' sel-f' : '') + '" onclick="setPart2(' + i + ',false)"' + (done ? ' disabled' : '') + '>âŒ é•å</button></div></div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz2()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz2-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ å·²æŒæ¡ Dependency Ruleã€‚</div>';
  h += '</div>';

  h += briefCard(2, 'Dependency Rule', [
    'æ‰€æœ‰ç¨‹å¼ç¢¼ä¾è³´æ–¹å‘åªèƒ½æŒ‡å‘å…§éƒ¨â€”â€”Presentation â†’ Domain â† Data',
    'Domain å±¤é›¶å¤–éƒ¨ä¾è³´ï¼Œæ ¸å¿ƒæ¥­å‹™é‚è¼¯å¯ç¨ç«‹æ¸¬è©¦ã€ç¨ç«‹éƒ¨ç½²',
    'ä»‹é¢å®šç¾©åœ¨ Domain å±¤ï¼Œç¢ºä¿é«˜å±¤æ¨¡çµ„ä¸ä¾è³´ä½å±¤å¯¦ä½œ'
  ], 'é€™æ¨£åˆ†å±¤ä¸æœƒå¢åŠ é–‹ç™¼æˆæœ¬å—ï¼Ÿ', 'çŸ­æœŸå¤šå¯«å¹¾å€‹æª”æ¡ˆï¼Œä½†é•·æœŸ Data å±¤æ›¿æ›ï¼ˆå¦‚æ”¹ç”¨ Room å¿«å–ï¼‰å®Œå…¨ä¸å½±éŸ¿ ViewModel å’Œ Domain å±¤ã€‚é€™æ˜¯æ¶æ§‹çš„æŠ•è³‡å ±é…¬ç‡ã€‚');
  return h;
}
function setPart2(i, v) { S.part2Answers[i] = v; save(); render(); }
function checkQuiz2() {
  var ans = [true, false, true, false];
  var ok = ans.every(function(a, i) { return S.part2Answers[i] === a; });
  var el = document.getElementById('quiz2-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨æ­£ç¢ºï¼</div>'; completePart(2); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ æœ‰äº›åˆ¤æ–·ä¸æ­£ç¢ºã€‚æç¤ºï¼šDomain å±¤ä¸å¯ä¾è³´å¤–å±¤çš„ä»»ä½•æ±è¥¿ã€‚</div>';
}

// ============================================================
// PART 3: åŒå¿ƒåœ“æ˜ å°„
// ============================================================
function getPart3() {
  var done = S.completedParts.includes(3), read = S.readParts.includes(3);
  var view = S.part3View || 'uncle';
  var h = '<div class="part-hdr"><span class="tag">Part 3</span><h1>ğŸ—ºï¸ åŒå¿ƒåœ“æ˜ å°„ â€” å››å±¤â†’ä¸‰å±¤</h1>' +
    '<p class="desc">Uncle Bob çš„ç¶“å…¸å››å±¤å¦‚ä½•å°æ‡‰åˆ° Android ç¤¾ç¾¤å¸¸ç”¨çš„ä¸‰å±¤æ¶æ§‹ï¼Ÿé—œéµä¸åœ¨å¹¾å±¤ï¼Œè€Œåœ¨ Dependency Ruleã€‚</p></div>';

  h += '<div class="glass-card"><div class="toggle-wrap"><div class="toggle-sw">' +
    '<div class="toggle-opt' + (view === 'uncle' ? ' active' : '') + '" onclick="setView(\'uncle\')">Uncle Bob å››å±¤</div>' +
    '<div class="toggle-opt' + (view !== 'uncle' ? ' active' : '') + '" onclick="setView(\'android\')">Android ä¸‰å±¤</div></div></div>';

  if (view === 'uncle') {
    h += '<div style="display:flex;flex-direction:column;gap:8px;margin:16px 0">' +
      '<div class="layer-box layer-box-green">' +
      '<strong>1. Entitiesï¼ˆå¯¦é«”ï¼‰</strong><br><span style="font-size:.85rem">Coin.kt, CoinPrice.kt</span></div>' +
      '<div class="layer-box layer-box-orange">' +
      '<strong>2. Use Casesï¼ˆæ‡‰ç”¨å±¤ï¼‰</strong><br><span style="font-size:.85rem">GetCoinsUseCaseï¼ˆCryptoTracker åŸç‰ˆçœç•¥ï¼‰</span></div>' +
      '<div class="layer-box layer-box-blue">' +
      '<strong>3. Interface Adaptersï¼ˆè½‰æ¥å±¤ï¼‰</strong><br><span style="font-size:.85rem">CoinMapper, CoinListViewModel, CoinUi</span></div>' +
      '<div class="layer-box layer-box-red">' +
      '<strong>4. Frameworks & Driversï¼ˆæœ€å¤–å±¤ï¼‰</strong><br><span style="font-size:.85rem">Ktor HttpClient, Jetpack Compose Screen</span></div></div>';
  } else {
    h += '<div style="display:flex;flex-direction:column;gap:8px;margin:16px 0">' +
      '<div class="layer-box layer-box-green">' +
      '<strong>Domain å±¤ï¼ˆæœ€å…§ï¼‰</strong><br><span style="font-size:.85rem">Coin, CoinPrice, CoinDataSource<br>= Entities + Use Cases</span></div>' +
      '<div class="layer-box layer-box-blue">' +
      '<strong>Data å±¤</strong><br><span style="font-size:.85rem">RemoteCoinDataSource, CoinMapper, CoinDto<br>= å‘å…§çš„ Interface Adapters + Frameworks</span></div>' +
      '<div class="layer-box layer-box-red">' +
      '<strong>Presentation å±¤ï¼ˆæœ€å¤–ï¼‰</strong><br><span style="font-size:.85rem">CoinListViewModel, CoinUi, Compose Screen<br>= å‘å¤–çš„ Interface Adapters + Frameworks</span></div></div>';
  }
  h += '</div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">å°ç…§è¡¨</h3>' +
    '<table class="cmp-table"><tr><th>Uncle Bob å››å±¤</th><th>Android ä¸‰å±¤</th><th>CryptoTracker</th></tr>' +
    '<tr><td>Entities</td><td>Domain å±¤</td><td>Coin.kt, CoinPrice.kt</td></tr>' +
    '<tr><td>Use Cases</td><td>Domain å±¤ï¼ˆå¸¸çœç•¥ï¼‰</td><td>åŸç‰ˆç„¡ Use Case</td></tr>' +
    '<tr><td>Interface Adapters</td><td>Data + Presentation</td><td>CoinMapper, ViewModel, CoinUi</td></tr>' +
    '<tr><td>Frameworks & Drivers</td><td>è¢«å¸æ”¶é€² Data/Presentation</td><td>Ktor, Compose</td></tr>' +
    '</table></div>';

  h += insightBlock(3, 'core/ ç›®éŒ„æ©«è·¨å¤šå±¤ï¼ˆcore.domainã€core.dataã€core.presentationï¼‰ï¼Œå®ƒä¸æ˜¯ç¨ç«‹çš„ç¬¬å››å±¤ï¼Œè€Œæ˜¯ã€Œæ¯ä¸€å±¤çš„å…±ç”¨éƒ¨åˆ†ã€ã€‚åˆ†å±¤åŸå‰‡ä»ç„¶é©ç”¨æ–¼ core/ å…§éƒ¨çš„å­ packageã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(3)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var opts = ['Entitiesï¼ˆå¯¦é«”å±¤ï¼‰', 'Use Casesï¼ˆæ‡‰ç”¨å±¤ï¼‰', 'Interface Adaptersï¼ˆè½‰æ¥å±¤ï¼‰', 'Frameworks & Driversï¼ˆæœ€å¤–å±¤ï¼‰'];
  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šé¸æ“‡é¡Œ</h3>' +
    '<p style="margin-bottom:16px;font-weight:600">CoinMapper å±¬æ–¼ Uncle Bob çš„å“ªä¸€å±¤ï¼Ÿ</p>';
  opts.forEach(function(o, i) {
    var sel = S.part3Answer === i;
    h += '<div class="quiz-opt' + (sel ? ' selected' : '') + '" onclick="setPart3(' + i + ')"' + (done ? ' style="pointer-events:none"' : '') + '>' +
      String.fromCharCode(65 + i) + '. ' + o + '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz3()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz3-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼CoinMapper æ˜¯è½‰æ¥å±¤â€”â€”è² è²¬ DTO â†” Domain ä¹‹é–“çš„ã€Œç¿»è­¯ã€ã€‚</div>';
  h += '</div>';

  h += briefCard(3, 'åŒå¿ƒåœ“æ˜ å°„', [
    'Uncle Bob å››å±¤æ¶æ§‹åœ¨ Android ç°¡åŒ–ç‚ºä¸‰å±¤ï¼Œæ ¸å¿ƒåŸå‰‡ä¸è®Š',
    'Interface Adapters è¢«æ‹†åˆ†â€”â€”è³‡æ–™è½‰æ¥æ­¸ Data å±¤ï¼ŒUI è½‰æ¥æ­¸ Presentation å±¤',
    'å±¤æ•¸ä¸æ˜¯é‡é»ï¼ŒDependency Rule æ‰æ˜¯â€”â€”ç„¡è«–å¹¾å±¤ï¼Œä¾è³´æ–¹å‘æ°¸é æŒ‡å‘å…§éƒ¨'
  ], 'æˆ‘å€‘ç”¨ä¸‰å±¤å¤ å—ï¼Ÿé‚„æ˜¯è¦ç”¨å››å±¤ï¼Ÿ', 'ä¸‰å±¤è¶³å¤ ã€‚ç•¶æ¥­å‹™é‚è¼¯è¤‡é›œåˆ°éœ€è¦ç¨ç«‹çš„ Use Case å±¤æ™‚ï¼Œå†å¾ Domain å±¤åˆ†å‡ºå³å¯ã€‚æ¶æ§‹æ˜¯æ¼¸é€²æ¼”åŒ–çš„ã€‚');
  return h;
}
function setView(v) { S.part3View = v; save(); render(); }
function setPart3(i) { S.part3Answer = i; save(); render(); }
function checkQuiz3() {
  var el = document.getElementById('quiz3-result');
  if (S.part3Answer === 2) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ æ­£ç¢ºï¼CoinMapper è² è²¬åœ¨ DTO å’Œ Domain ä¹‹é–“åšç¿»è­¯ã€‚</div>'; completePart(3); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ å†æƒ³æƒ³çœ‹ã€‚CoinMapper çš„åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿå®ƒåœ¨å“ªå…©å±¤ä¹‹é–“åšç¿»è­¯ï¼Ÿ</div>';
}

// ============================================================
// PART 4: é€å±¤èµ°è®€
// ============================================================
function getPart4() {
  var done = S.completedParts.includes(4), read = S.readParts.includes(4);
  var h = '<div class="part-hdr"><span class="tag">Part 4</span><h1>ğŸ“– é€å±¤å¯¦æˆ°èµ°è®€</h1><p class="desc">è¿½è¹¤ä¸€æ¬¡ã€Œå–å¾—å¹£ç¨®æ¸…å–®ã€å¾ä½¿ç”¨è€…æ“ä½œåˆ° API å›å‚³çš„å®Œæ•´ 10 æ­¥è³‡æ–™æµã€‚</p></div>';
  var steps = [
    {n:1, file:'Coin.kt', title:'Entity â€” ç´”ç²¹æ¥­å‹™æ¨¡å‹', desc:'data classï¼Œé›¶ importã€é›¶æ¡†æ¶ä¾è³´ã€‚ç”¨ Double å„²å­˜é‡‘é¡ï¼Œæ ¼å¼åŒ–æ˜¯ UI çš„äº‹ã€‚'},
    {n:2, file:'CoinDataSource.kt', title:'Repository ä»‹é¢', desc:'å®šç¾©åœ¨ Domain å±¤ã€‚å›å‚³ Domain çš„ Coinï¼Œä¸æ˜¯ CoinDtoã€‚ç”¨è‡ªå®šç¾© Result<D, E> è€Œéæ‹‹ Exceptionã€‚'},
    {n:3, file:'Result.kt', title:'å‹åˆ¥å®‰å…¨éŒ¯èª¤è™•ç†', desc:'sealed interface ä¿è­‰ when ä¸éœ€è¦ elseã€‚é›™æ³›å‹ <D, E> è®“æˆåŠŸå’ŒéŒ¯èª¤éƒ½æœ‰å‹åˆ¥ã€‚'},
    {n:4, file:'CoinDto.kt', title:'DTO æ•¸æ“šå‚³è¼¸ç‰©ä»¶', desc:'@Serializable æ¨™è¨˜æ˜¯ Data å±¤çš„æŠ€è¡“ç´°ç¯€ã€‚DTO ä½åœ¨ data/networking/dto/ã€‚'},
    {n:5, file:'CoinMapper.kt', title:'Mapper è½‰æ›å±¤', desc:'æ“´å±•å‡½å¼ CoinDto.toCoin()â€”â€”Kotlin æ…£ç”¨å¯«æ³•ã€‚æ–¹å‘æ°¸é æ˜¯ Data â†’ Domainã€‚'},
    {n:6, file:'RemoteCoinDataSource.kt', title:'å¯¦ä½œ DataSource', desc:'å¯¦ä½œ CoinDataSource ä»‹é¢ã€‚safeCall åŒ…è£ + map è½‰æ› DTO â†’ Domain Modelã€‚'},
    {n:7, file:'CoinUi.kt', title:'UI Model', desc:'Double è®Š DisplayableNumberï¼ˆå«æ ¼å¼åŒ–å­—ä¸²ï¼‰ã€‚å¤šäº† @DrawableRes iconResã€‚'},
    {n:8, file:'CoinListState.kt', title:'UI State', desc:'@Immutable Compose å„ªåŒ–æ¨™è¨˜ã€‚ä½¿ç”¨ CoinUi ä¸æ˜¯ Coinâ€”â€”æ¯å±¤ç”¨è‡ªå·±çš„èªè¨€ã€‚'},
    {n:9, file:'CoinListViewModel.kt', title:'ViewModel', desc:'å»ºæ§‹åƒæ•¸æ˜¯ä»‹é¢ CoinDataSourceã€‚åœ¨ onSuccess è£¡å‘¼å« toCoinUi() è½‰æ›ã€‚'},
    {n:10, file:'AppModule.kt', title:'DI ä¸²æ¥', desc:'singleOf(::RemoteCoinDataSource).bind<CoinDataSource>() æ˜¯æ•´å€‹æ¶æ§‹çš„é»åˆåŠ‘ã€‚'}
  ];
  steps.forEach(function(s) {
    h += '<div class="step-card"><span class="step-num">' + s.n + '</span><strong>' + s.title + '</strong>' +
      '<div class="step-file">' + s.file + '</div><p style="font-size:.9rem;color:var(--txt2)">' + s.desc + '</p></div>';
  });

  h += insightBlock(4, 'è³‡æ–™è½‰æ›ä¸‰æ¬¡ï¼ˆDTO â†’ Domain â†’ UI Modelï¼‰çœ‹ä¼¼æµªè²»ï¼Œä½†å¦‚æœ API æ ¼å¼è®Šäº†ï¼Œä½ åªéœ€è¦æ”¹ CoinDto å’Œ CoinMapperï¼ŒViewModel å’Œ Screen å®Œå…¨ä¸å—å½±éŸ¿ã€‚é€™å°±æ˜¯ Clean Architecture çš„æŠ•è³‡å ±é…¬ç‡ã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(4)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var labels = ['ä½¿ç”¨è€…é»æ“Š Screen', 'ViewModel å‘¼å« CoinDataSource ä»‹é¢', 'DI æ³¨å…¥ RemoteCoinDataSource', 'Ktor HttpClient å‘¼å« API',
    'CoinMapper å°‡ CoinDto è½‰ç‚º Coin', 'ViewModel æ”¶åˆ° Result<List<Coin>>', 'toCoinUi() è½‰ç‚º CoinUi', 'Screen æ ¹æ“š State æ¸²æŸ“æ›´æ–°'];
  if (!S.part4Order || S.part4Order.length !== 8) { S.part4Order = [3, 6, 1, 4, 7, 0, 2, 5]; save(); }

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šæ’åˆ—è³‡æ–™æµé †åº</h3><p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">ç”¨ â–² â–¼ æŒ‰éˆ•å°‡æ­¥é©Ÿæ’æˆæ­£ç¢ºé †åº</p>';
  S.part4Order.forEach(function(idx, pos) {
    h += '<div class="sort-item"><span class="num">' + (pos + 1) + '</span><span class="text">' + labels[idx] + '</span>' +
      (!done ? '<button class="sort-btn" onclick="movePart4(' + pos + ',-1)">â–²</button><button class="sort-btn" onclick="movePart4(' + pos + ',1)">â–¼</button>' : '') +
      '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz4()" style="margin-top:16px">ç¢ºèªé †åº</button>';
  h += '<div id="quiz4-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ æŒæ¡äº†å®Œæ•´çš„è³‡æ–™æµã€‚</div>';
  h += '</div>';

  h += briefCard(4, 'é€å±¤èµ°è®€', [
    'ä¸€æ¬¡ API è«‹æ±‚ç¶“é 10 å€‹æª”æ¡ˆï¼Œè³‡æ–™åœ¨æ¯å±¤è¢«ã€Œç¿»è­¯ã€æˆè©²å±¤çš„èªè¨€ï¼ˆDTO â†’ Domain â†’ UI Modelï¼‰',
    'æ¯å±¤ä¹‹é–“çš„ Mapper ç¢ºä¿å„å±¤å¯ç¨ç«‹è®Šæ›´è€Œä¸äº’ç›¸å½±éŸ¿',
    'DIï¼ˆKoinï¼‰æ˜¯æ•´å€‹æ¶æ§‹çš„é»åˆåŠ‘â€”â€”åœ¨ AppModule å°‡ä»‹é¢èˆ‡å¯¦ä½œç¶å®š'
  ], 'è³‡æ–™æµç¶“é€™éº¼å¤šå±¤ä¸æœƒå½±éŸ¿æ•ˆèƒ½å—ï¼Ÿ', 'ç‰©ä»¶è½‰æ›åœ¨è¨˜æ†¶é«”ä¸­å®Œæˆï¼Œå¹¾ä¹é›¶æˆæœ¬ã€‚çœŸæ­£çš„æ•ˆèƒ½ç“¶é ¸åœ¨ç¶²è·¯è«‹æ±‚å’Œè³‡æ–™åº«æŸ¥è©¢ï¼Œä¸åœ¨æ¶æ§‹å±¤ç´šã€‚');
  return h;
}
function movePart4(pos, dir) {
  var np = pos + dir;
  if (np < 0 || np >= S.part4Order.length) return;
  var tmp = S.part4Order[pos];
  S.part4Order[pos] = S.part4Order[np];
  S.part4Order[np] = tmp;
  save(); render();
}
function checkQuiz4() {
  var ok = S.part4Order.every(function(v, i) { return v === i; });
  var el = document.getElementById('quiz4-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å®Œç¾æ’åºï¼</div>'; completePart(4); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ é †åºä¸å°ã€‚æç¤ºï¼šå¾ä½¿ç”¨è€…æ“ä½œé–‹å§‹ï¼Œåˆ° Screen æ¸²æŸ“çµæŸã€‚</div>';
}

// ============================================================
// PART 5: YT Dev vs Google NIA
// ============================================================
function getPart5() {
  var done = S.completedParts.includes(5), read = S.readParts.includes(5);
  var h = '<div class="part-hdr"><span class="tag">Part 5</span><h1>âš–ï¸ YT Dev vs Google NIA</h1><p class="desc">å…©å¤§ Clean Architecture æµæ´¾çš„ 6 å¤§å·®ç•°æ·±åº¦æ¯”è¼ƒâ€”â€”æ²’æœ‰ã€Œæ­£ç¢ºç­”æ¡ˆã€ï¼Œåªæœ‰ã€Œé©åˆçš„é¸æ“‡ã€ã€‚</p></div>';

  var cmps = [
    {cat:'æ¨¡çµ„ç­–ç•¥', yt:'å–®æ¨¡çµ„ï¼Œç”¨ package åˆ†å±¤ã€‚åˆ†å±¤é é–‹ç™¼è€…è‡ªå¾‹ã€‚', nia:'å¤šæ¨¡çµ„ï¼Œæ¯å±¤/æ¯ feature ä¸€å€‹ Gradle moduleã€‚Gradle ç·¨è­¯æœŸå¼·åˆ¶ä¾è³´æ–¹å‘ã€‚'},
    {cat:'Repository ä½ç½®', yt:'ä»‹é¢å®šç¾©åœ¨ Domain å±¤ï¼ˆéµå¾ª DIPï¼‰', nia:'ä»‹é¢å®šç¾©åœ¨ Data å±¤ï¼ˆèªç‚º Repository æ˜¯ Data çš„æŠ½è±¡ï¼‰'},
    {cat:'Use Case å±¤', yt:'çœç•¥ã€‚ViewModel ç›´æ¥å‘¼å« DataSourceã€‚', nia:'å¤§é‡ä½¿ç”¨ã€‚ViewModel â†’ UseCase â†’ Repositoryã€‚'},
    {cat:'éŒ¯èª¤è™•ç†', yt:'è‡ªå®šç¾© Result<D, E> sealed interfaceâ€”â€”å‹åˆ¥å®‰å…¨', nia:'Kotlin å…§å»º Exception + try/catchâ€”â€”ç°¡æ½”'},
    {cat:'UI æ¨¡å‹', yt:'å°ˆç”¨ CoinUi UI Modelï¼Œèˆ‡ Domain å®Œå…¨åˆ†é›¢', nia:'é€šå¸¸ç›´æ¥ç”¨ Domain Model'},
    {cat:'DI æ¡†æ¶', yt:'Koinï¼ˆç´” Kotlin DSLï¼Œruntime è§£æï¼‰', nia:'Hiltï¼ˆåŸºæ–¼ Daggerï¼Œcompile-time é©—è­‰ï¼‰'}
  ];

  h += '<div class="glass-card"><table class="cmp-table"><tr><th>é¢å‘</th><th style="color:var(--lav)">YT Devï¼ˆCryptoTrackerï¼‰</th><th style="color:var(--pink)">Google NIA</th></tr>';
  cmps.forEach(function(c) { h += '<tr><td><strong>' + c.cat + '</strong></td><td>' + c.yt + '</td><td>' + c.nia + '</td></tr>'; });
  h += '<tr class="cmp-row-summary"><td><strong>é©åˆ</strong></td><td>å¿«é€Ÿé–‹ç™¼ã€å°åœ˜éšŠã€å­¸ç¿’</td><td>å¤§å‹å°ˆæ¡ˆã€å¤šåœ˜éšŠã€é•·æœŸç¶­è­·</td></tr></table></div>';

  h += insightBlock(5, 'Google NIA å°ˆæ¡ˆæœ‰è¶…é 60 å€‹ Gradle moduleã€‚æ¯å€‹ module çš„ build.gradle éƒ½æœ‰æ˜ç¢ºçš„ä¾è³´å®£å‘Šï¼Œç·¨è­¯å™¨åœ¨ build time å°±æœƒå‘Šè¨´ä½ æ˜¯å¦é•åäº† Dependency Ruleâ€”â€”æ¯”é  code review å¯é å¾—å¤šã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(5)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var opts = ['YT Dev å–®æ¨¡çµ„é¢¨æ ¼ â€” ç°¡å–®ä½†å®¹æ˜“å¤±æ§', 'Google NIA å¤šæ¨¡çµ„é¢¨æ ¼ â€” ç·¨è­¯æœŸå¼·åˆ¶ä¾è³´æ–¹å‘', 'ä¸éœ€è¦ Clean Architectureï¼Œç›´æ¥å¯«å°±å¥½'];
  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šæƒ…å¢ƒé¡Œ</h3>' +
    '<p style="margin-bottom:16px;font-weight:600">ä½ çš„åœ˜éšŠæœ‰ 15 äººï¼Œéœ€è¦ç¶­è­· 50+ featureï¼Œé©åˆå“ªç¨®é¢¨æ ¼ï¼Ÿ</p>';
  opts.forEach(function(o, i) {
    var sel = S.part5Answer === i;
    h += '<div class="quiz-opt' + (sel ? ' selected' : '') + '" onclick="setPart5(' + i + ')"' + (done ? ' style="pointer-events:none"' : '') + '>' + String.fromCharCode(65 + i) + '. ' + o + '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz5()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz5-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼å¤§åœ˜éšŠéœ€è¦ç·¨è­¯æœŸçš„å¼·åˆ¶ä¿éšœã€‚</div>';
  h += '</div>';

  h += briefCard(5, 'å…©å¤§æµæ´¾æ¯”è¼ƒ', [
    'YT Dev é¢¨æ ¼é©åˆå°åœ˜éšŠå¿«é€Ÿé–‹ç™¼ï¼ŒGoogle NIA é©åˆå¤§åœ˜éšŠé•·æœŸç¶­è­·',
    'æ¨¡çµ„åŒ–çš„çœŸæ­£åƒ¹å€¼ï¼šGradle ä¾è³´è¨­å®šèƒ½ã€Œç·¨è­¯æœŸå¼·åˆ¶ã€Dependency Rule',
    'æ²’æœ‰ã€Œæ­£ç¢ºçš„ Clean Architectureã€ï¼Œåªæœ‰ã€Œé©åˆä½ åœ˜éšŠçš„ã€'
  ], 'æˆ‘å€‘ç¾åœ¨è©²é¸å“ªç¨®ï¼Ÿ', 'å»ºè­°å…ˆç”¨ YT Dev é¢¨æ ¼å¿«é€Ÿé©—è­‰ï¼Œç­‰åœ˜éšŠè¶…é 5 äººæˆ–æ¥­å‹™é‚è¼¯è¤‡é›œæ™‚ï¼Œå†æ¼¸é€²å¼•å…¥ Use Case å’Œå¤šæ¨¡çµ„ã€‚');
  return h;
}
function setPart5(i) { S.part5Answer = i; save(); render(); }
function checkQuiz5() {
  var el = document.getElementById('quiz5-result');
  if (S.part5Answer === 1) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ æ­£ç¢ºï¼15 äººåœ˜éšŠéœ€è¦æ¨¡çµ„åŒ–ä¾†å¼·åˆ¶æ¶æ§‹è¦ç¯„ã€‚</div>'; completePart(5); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ å†æƒ³æƒ³â€”â€”15 äººåœ˜éšŠå¦‚æœåªé è‡ªå¾‹ï¼ŒDependency Rule å¾ˆå®¹æ˜“è¢«æ‰“ç ´ã€‚</div>';
}

// ============================================================
// PART 6: å‹•æ‰‹ç·´ç¿’
// ============================================================
function getPart6() {
  var done = S.completedParts.includes(6);
  var h = '<div class="part-hdr"><span class="tag">Part 6</span><h1>ğŸ› ï¸ å‹•æ‰‹ç·´ç¿’ â€” åŠ å…¥ Use Case å±¤</h1><p class="desc">åœ¨ CryptoTracker ä¸­å¯¦ä½œ GetCoinsUseCaseï¼Œé«”é©— Google NIA é¢¨æ ¼ã€‚å®Œæˆå¾Œç²å¾— 200 XPï¼</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ğŸ“‹ ä»»å‹™èªªæ˜</h3>' +
    '<p style="margin-bottom:12px">å¯¦ä½œ <code>GetCoinsUseCase</code>ï¼šå¾ CoinDataSource å–å¾—å¹£ç¨®åˆ—è¡¨ï¼Œä¸¦ç¯©é¸å‡º rank â‰¤ 50 çš„å¹£ç¨®ã€‚</p>' +
    '<p style="margin-bottom:16px;color:var(--txt2);font-size:.85rem">éœ€è¦åŒ…å«ï¼š<code>operator fun invoke()</code>ã€<code>suspend</code>ã€<code>filter</code>ã€çµæœè½‰æ›</p>';

  h += '<h4 style="margin-bottom:8px">éª¨æ¶ç¨‹å¼ç¢¼ï¼š</h4>';
  h += codeBlock('class GetCoinsUseCase(\n    private val coinDataSource: CoinDataSource\n) {\n    // ä½ çš„ç¨‹å¼ç¢¼å¯«åœ¨ä¸‹æ–¹ç·¨è¼¯å™¨\n}');

  h += '<h4 style="margin:16px 0 8px">æç¤ºï¼š</h4>';
  h += '<div class="accordion"><button class="acc-head" onclick="toggleAcc(this)"><span>ğŸ’¡ Result.map ç”¨æ³•</span><span class="arrow">â–¼</span></button>' +
    '<div class="acc-body"><div class="acc-inner">' + codeBlock('// Result.map æ“´å±•å‡½å¼è®“ä½ åœ¨ä¸æ‹†é–‹ Result çš„æƒ…æ³ä¸‹è½‰æ›è³‡æ–™\ninline fun <T, E: Error, R> Result<T, E>.map(map: (T) -> R): Result<R, E> {\n    return when(this) {\n        is Result.Error -> Result.Error(error)\n        is Result.Success -> Result.Success(map(data))\n    }\n}') + '</div></div></div>';

  h += '<h4 style="margin:16px 0 8px">åœ¨æ­¤æ’°å¯«ä½ çš„ invoke å‡½å¼ï¼š</h4>' +
    '<textarea class="code-editor" id="part6-editor" placeholder="suspend operator fun invoke(): Result<List<Coin>, NetworkError> {\n    // åœ¨é€™è£¡å¯«ä½ çš„å¯¦ä½œ\n}"' + (done ? ' disabled' : '') + '>' + escapeHtmlAttr(S.part6Code) + '</textarea>';

  if (!done) {
    h += '<div style="display:flex;gap:8px;margin-top:12px">' +
      '<button class="btn btn-pri" onclick="checkQuiz6()">æäº¤é©—è­‰</button>' +
      '<button class="btn btn-sec" onclick="showPart6Hint()">é¡¯ç¤ºç¯„ä¾‹</button></div>';
  }
  h += '<div id="quiz6-result"></div>';
  if (done) h += '<div class="quiz-result pass" style="margin-top:12px">âœ… å·²é€šéï¼ä½ æˆåŠŸå¯¦ä½œäº† Use Caseã€‚</div>';
  h += '<div id="part6-sample" style="display:none;margin-top:16px"><h4>ç¯„ä¾‹è§£ç­”ï¼š</h4>' +
    codeBlock('suspend operator fun invoke(): Result<List<Coin>, NetworkError> {\n    return coinDataSource\n        .getCoins()\n        .map { coins ->\n            coins.filter { it.rank <= 50 }\n        }\n}') + '</div>';
  h += '</div>';

  h += insightBlock(6, 'operator fun invoke() æ˜¯ Kotlin èªæ³•ç³–ã€‚è®“ GetCoinsUseCase å¯¦ä¾‹å¯ä»¥åƒå‡½å¼ä¸€æ¨£å‘¼å«ï¼šgetCoinsUseCase() ç­‰åŒæ–¼ getCoinsUseCase.invoke()ã€‚é€™ä¸åªæ˜¯èªæ³•ä¾¿åˆ©ï¼Œæ›´ä»£è¡¨ Use Case å°±æ˜¯ä¸€å€‹ã€Œå¯åŸ·è¡Œçš„æ¥­å‹™æ„åœ–ã€ã€‚');

  h += briefCard(6, 'å‹•æ‰‹ç·´ç¿’', [
    'Use Case å°è£æ¥­å‹™é‚è¼¯ï¼ˆç¯©é¸å‰ 50 åï¼‰ï¼Œè®“ ViewModel ä¿æŒè¼•è–„',
    'operator fun invoke() è®“å‘¼å«ç«¯ç”¨ useCase() èªæ³•ï¼Œåƒå‘¼å«å‡½å¼ä¸€æ¨£è‡ªç„¶',
    'Use Case æ˜¯æ¼¸é€²å¼çš„â€”â€”å…ˆå¾ç°¡å–®çš„è½‰ç™¼é–‹å§‹ï¼Œé‚è¼¯å¢é•·æ™‚è‡ªç„¶æ‰¿æ¥'
  ], 'åŠ äº† Use Case å€¼å¾—å—ï¼Ÿ', 'ç•¶ ViewModel æœ‰è¶…é 3 å€‹æ¥­å‹™é‚è¼¯æ“ä½œæ™‚å°±å€¼å¾—ã€‚å®ƒè®“é‚è¼¯å¯è¢«ä¸åŒ ViewModel é‡è¤‡ä½¿ç”¨ï¼Œä¹Ÿæ›´å®¹æ˜“åšå–®å…ƒæ¸¬è©¦ã€‚');
  return h;
}
function checkQuiz6() {
  var code = document.getElementById('part6-editor').value;
  S.part6Code = code; save();
  var checks = ['operator', 'fun', 'invoke', 'suspend', 'filter'];
  var hasMap = code.includes('.map') || code.includes('.map {');
  var pass = checks.every(function(k) { return code.includes(k); }) && hasMap;
  var el = document.getElementById('quiz6-result');
  if (pass) {
    el.innerHTML = '<div class="quiz-result pass">ğŸ‰ é€šéé©—è­‰ï¼åŒ…å«æ‰€æœ‰é—œéµå…ƒç´ ã€‚</div>';
    document.getElementById('part6-sample').style.display = 'block';
    completePart(6);
  } else {
    var missing = checks.filter(function(k) { return !code.includes(k); });
    if (!hasMap) missing.push('map (Result è½‰æ›)');
    el.innerHTML = '<div class="quiz-result fail">âŒ ç¼ºå°‘é—œéµå…ƒç´ ï¼š' + missing.join('ã€') + '</div>';
  }
}
function showPart6Hint() { document.getElementById('part6-sample').style.display = 'block'; }

// ============================================================
// PART 7: è²»æ›¼é©—è­‰
// ============================================================
function getPart7() {
  var done = S.completedParts.includes(7);
  var questions = [
    {q:'ç”¨ä¸€å¥è©±è§£é‡‹ Clean Architecture çš„ Dependency Rule', keys:['ä¾è³´','å…§','æŒ‡å‘'], ref:'æ‰€æœ‰åŸå§‹ç¢¼çš„ä¾è³´æ–¹å‘å¿…é ˆåªèƒ½æŒ‡å‘å…§éƒ¨â€”â€”å¤–å±¤å¯ä»¥çŸ¥é“å…§å±¤ï¼Œä½†å…§å±¤çµ•ä¸èƒ½çŸ¥é“å¤–å±¤çš„å­˜åœ¨ã€‚'},
    {q:'ç‚ºä»€éº¼ CoinDataSource ä»‹é¢æ”¾åœ¨ Domain å±¤è€Œä¸æ˜¯ Data å±¤ï¼Ÿ', keys:['é«˜å±¤','ä»‹é¢','Domain','DIP','ä¾è³´åè½‰'], ref:'é€™æ˜¯ä¾è³´åè½‰åŸå‰‡ï¼ˆDIPï¼‰çš„å¯¦è¸â€”â€”é«˜å±¤ï¼ˆDomainï¼‰å®šç¾©å¥‘ç´„ï¼Œä½å±¤ï¼ˆDataï¼‰è² è²¬å¯¦ä½œã€‚å¦‚æœä»‹é¢æ”¾åœ¨ Data å±¤ï¼ŒDomain å°±æœƒåéä¾†ä¾è³´ Dataï¼Œé•å Dependency Ruleã€‚'},
    {q:'ä½•æ™‚æ‡‰è©²åŠ å…¥ Use Case å±¤ï¼Ÿä½•æ™‚å¯ä»¥çœç•¥ï¼Ÿ', keys:['æ¥­å‹™é‚è¼¯','è¤‡é›œ','é‡è¤‡','ViewModel'], ref:'ç•¶æ¥­å‹™é‚è¼¯åªæ˜¯ç°¡å–®çš„ã€Œå–è³‡æ–™â†’é¡¯ç¤ºã€æ™‚å¯ä»¥çœç•¥ã€‚ç•¶é‚è¼¯åŒ…å«ç¯©é¸ã€æ’åºã€åˆä½µå¤šå€‹ä¾†æºã€æˆ–éœ€è¦è¢«å¤šå€‹ ViewModel å…±ç”¨æ™‚ï¼Œå°±è©²åŠ å…¥ Use Case å°è£ã€‚'},
    {q:'å¦‚æœä¸»ç®¡å•ä½ ç‚ºä»€éº¼ä¸ç›´æ¥è®“ ViewModel ç”¨ RemoteCoinDataSourceï¼Œä½ æ€éº¼å›ç­”ï¼Ÿ', keys:['ä»‹é¢','æ›¿æ›','æ¸¬è©¦','è€¦åˆ'], ref:'ç›´æ¥ä¾è³´å…·é«”é¡æœƒé€ æˆå¼·è€¦åˆâ€”â€”æƒ³æ›æˆæœ¬åœ°å¿«å–è¦æ”¹ ViewModelï¼Œæƒ³å¯«æ¸¬è©¦è¦èµ·çœŸçš„ HTTP ä¼ºæœå™¨ã€‚é€éä»‹é¢ï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†æ›¿æ›å¯¦ä½œï¼Œå–®å…ƒæ¸¬è©¦ç”¨ Fakeã€ä¸Šç·šç”¨ Remoteã€é›¢ç·šç”¨ Localã€‚'}
  ];

  var h = '<div class="part-hdr"><span class="tag">Part 7</span><h1>ğŸ“ è²»æ›¼é©—è­‰ â€” ç”¨è‡ªå·±çš„è©±è§£é‡‹</h1><p class="desc">å¦‚æœä½ èƒ½ç”¨ç°¡å–®çš„èªè¨€è§£é‡‹é€™äº›æ¦‚å¿µï¼Œä»£è¡¨ä½ çœŸæ­£ç†è§£äº†ã€‚å®Œæˆå¾Œç²å¾— 150 XP å’Œã€Œæ¶æ§‹å¸«ã€ç¨±è™Ÿï¼</p></div>';

  h += '<div class="glass-card">';
  questions.forEach(function(q, i) {
    h += '<div class="feynman-q"><label>Q' + (i + 1) + 'ï¼š' + q.q + '</label>' +
      '<textarea class="feynman-ta" id="feynman-' + i + '" placeholder="ç”¨ä½ è‡ªå·±çš„è©±å¯«ä¸‹ç­”æ¡ˆ..."' + (done ? ' disabled' : '') + '>' + escapeHtmlAttr(S.part7Answers[i]) + '</textarea>';
    if (done) {
      h += '<div class="feynman-ref show"><strong>åƒè€ƒç­”æ¡ˆï¼š</strong>' + q.ref + '</div>';
      h += '<div class="rating">';
      for (var s = 1; s <= 5; s++) h += '<span class="rating-star' + (s <= S.part7Ratings[i] ? ' lit' : '') + '" onclick="ratePart7(' + i + ',' + s + ')">â˜…</span>';
      h += '<span style="font-size:.8rem;color:var(--txt2);margin-left:8px">è‡ªè©•ï¼šç†è§£ç¨‹åº¦</span></div>';
    }
    h += '</div>';
  });

  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz7()" style="margin-top:12px">æäº¤é©—è­‰</button>';
  h += '<div id="quiz7-result"></div>';
  if (done) h += '<div class="quiz-result pass" style="margin-top:12px">âœ… æ­å–œï¼ä½ å·²å®Œæˆè²»æ›¼é©—è­‰ï¼Œæˆç‚ºçœŸæ­£çš„æ¶æ§‹å¸«ï¼</div>';
  h += '</div>';

  h += insightBlock(7, 'è²»æ›¼å­¸ç¿’æ³•çš„æ ¸å¿ƒæ˜¯ã€Œæ•™æ˜¯æœ€å¥½çš„å­¸ã€ã€‚å¦‚æœä½ èƒ½å‘ä¸€å€‹ä¸æ‡‚ç¨‹å¼çš„äººè§£é‡‹ Clean Architectureï¼Œä½ å°±çœŸæ­£æŒæ¡äº†å®ƒã€‚å‘ä¸»ç®¡ç°¡å ±ä¸æ˜¯è² æ“”ï¼Œè€Œæ˜¯é©—è­‰ç†è§£æ·±åº¦çš„æ©Ÿæœƒã€‚');

  h += briefCard(7, 'è²»æ›¼é©—è­‰', [
    'èƒ½ç”¨ç°¡å–®èªè¨€è§£é‡‹æ¶æ§‹æ±ºç­–ï¼Œä»£è¡¨çœŸæ­£ç†è§£è€ŒéèƒŒèª¦',
    'æ¶æ§‹å¸«çš„åƒ¹å€¼åœ¨æ–¼èƒ½å‘éæŠ€è¡“äººå“¡è§£é‡‹ã€Œç‚ºä»€éº¼é€™æ¨£åšã€',
    'è²»æ›¼å­¸ç¿’æ³•â€”â€”å¦‚æœè§£é‡‹ä¸æ¸…æ¥šï¼Œå°±å›å»é‡æ–°ç†è§£'
  ], 'ä½ ç¢ºå®šä½ æ‡‚é€™äº›æ¶æ§‹å—ï¼Ÿ', 'æˆ‘å¯ä»¥ç”¨ä¸‰å¥è©±è§£é‡‹ï¼šä¾è³´æ–¹å‘æ°¸é æŒ‡å‘å…§éƒ¨ï¼Œæ¯å±¤ç”¨è‡ªå·±çš„èªè¨€èªªè©±ï¼Œä»‹é¢å®šç¾©åœ¨å…§å±¤ã€å¯¦ä½œåœ¨å¤–å±¤ã€‚');
  return h;
}
function ratePart7(i, s) { S.part7Ratings[i] = s; save(); render(); }
function checkQuiz7() {
  var questions = [
    {keys:['ä¾è³´','å…§','æŒ‡å‘']},
    {keys:['é«˜å±¤','ä»‹é¢','Domain','DIP','ä¾è³´åè½‰','å¥‘ç´„']},
    {keys:['æ¥­å‹™é‚è¼¯','è¤‡é›œ','é‡è¤‡','ViewModel','é‚è¼¯']},
    {keys:['ä»‹é¢','æ›¿æ›','æ¸¬è©¦','è€¦åˆ','æŠ½è±¡']}
  ];
  for (var i = 0; i < 4; i++) {
    var ta = document.getElementById('feynman-' + i);
    if (ta) S.part7Answers[i] = ta.value;
  }
  save();
  var allPass = true;
  var missing = [];
  questions.forEach(function(q, i) {
    var ans = S.part7Answers[i] || '';
    if (ans.length < 10) { allPass = false; missing.push('Q' + (i + 1) + ': ç­”æ¡ˆå¤ªçŸ­'); return; }
    var found = q.keys.some(function(k) { return ans.includes(k); });
    if (!found) { allPass = false; missing.push('Q' + (i + 1) + ': ç¼ºå°‘æ ¸å¿ƒæ¦‚å¿µé—œéµå­—'); }
  });
  var el = document.getElementById('quiz7-result');
  if (allPass) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨é€šéï¼ä½ å·²å±•ç¾å‡ºå° Clean Architecture çš„æ·±åº¦ç†è§£ã€‚</div>'; completePart(7); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ ' + missing.join('ï¼›') + '<br>æç¤ºï¼šå˜—è©¦ä½¿ç”¨æ ¸å¿ƒæ¦‚å¿µè©å½™ä¾†è¡¨é”ä½ çš„ç†è§£ã€‚</div>';
}

// ============================================================
// INIT
// ============================================================
var TOPIC_PARTS = [getPart1, getPart2, getPart3, getPart4, getPart5, getPart6, getPart7];

document.addEventListener('DOMContentLoaded', function() {
  if (typeof LearningEngine !== 'undefined') {
    LearningEngine.init(TOPIC_CONFIG, TOPIC_PARTS);
  }
});
</script>
</body>
</html>
