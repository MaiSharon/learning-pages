<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compose Material3 å…­å¤§è¨­è¨ˆæ¨¡å¼</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
<link rel="stylesheet" href="../core/engine.css">
<style>
.layer-diagram{display:flex;flex-direction:column;gap:8px;margin:16px 0}
.layer-box{padding:14px 20px;border-radius:var(--rs);text-align:center;font-weight:600;font-size:.85rem}
.layer-api{background:#e8f5e9;color:#2e7d32;border:2px solid #a5d6a7}
.layer-base{background:#e3f2fd;color:#1565c0;border:2px solid #90caf9}
.layer-layout{background:#fce4ec;color:#c62828;border:2px solid #ef9a9a}
.layer-arrow{text-align:center;font-size:1.2rem;color:var(--lav)}
.param-group{padding:12px 16px;border-radius:var(--rs);margin-bottom:8px}
.param-modifier{background:#e3f2fd;border-left:3px solid #1565c0}
.param-style{background:#e8f5e9;border-left:3px solid #2e7d32}
.param-slot{background:#fff3e0;border-left:3px solid #ff9800}
.param-behavior{background:#fce4ec;border-left:3px solid #c62828}
</style>
</head>
<body>

<div class="opening" id="opening">
  <div class="opening-box">
    <div style="font-size:3rem;margin-bottom:16px">ğŸ§©</div>
    <h1>M3 æ¨¡å¼å¤§å¸«</h1>
    <p class="sub">ä½ å³å°‡æ·±å…¥ Jetpack Compose Material3 çš„åŸå§‹ç¢¼ï¼Œ<br>è§£é– Google å·¥ç¨‹å¸«ä½¿ç”¨çš„ 6 å¤§å…ƒä»¶è¨­è¨ˆæ¨¡å¼ã€‚<br><br>å¾ Slot API åˆ° SubcomposeLayoutï¼Œ<br>æŒæ¡å»ºæ§‹å¯å¾©ç”¨ Compose å…ƒä»¶çš„ç²¾é«“ã€‚</p>
    <button class="btn-start" onclick="startJourney()">é–‹å§‹æ—…ç¨‹</button>
  </div>
</div>

<header class="topbar" id="topbar">
  <button class="hamburger" onclick="toggleSidebar()" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>
  <div class="logo">ğŸ§© M3 Patterns</div>
  <div class="progress-wrap"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
  <div class="xp-badge">âš¡ <span class="num" id="xp-num">0</span> XP</div>
  <div class="streak-tag" id="streak-tag" style="display:none"></div>
  <div class="badge-row" id="badge-row"></div>
</header>

<nav class="sidebar" id="sidebar"></nav>
<main class="main" id="main-content"></main>
<div class="toast-wrap" id="toast-wrap"></div>

<script src="../core/trainer.js" onerror="document.getElementById('main-content').innerHTML='<div style=\'padding:40px;text-align:center;color:#c44\'>è¼‰å…¥å¤±æ•—ï¼štrainer.js ç„¡æ³•è¼‰å…¥ã€‚è«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚</div>'"></script>
<script src="../core/engine.js" onerror="document.getElementById('main-content').innerHTML='<div style=\'padding:40px;text-align:center;color:#c44\'>è¼‰å…¥å¤±æ•—ï¼šengine.js ç„¡æ³•è¼‰å…¥ã€‚è«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚</div>'"></script>
<script>
var TOPIC_CONFIG = {
  id: 'm3-patterns',
  legacyKeys: [],
  totalXP: 1350,
  hlKeywords: 'fun|val|var|class|object|interface|override|internal|private|if|else|return|when|is|as|get|import|package|data|sealed|enum|companion|suspend|inline|operator|open|abstract|annotation|const|by|lazy|true|false|null|it|in|out',
  hlTypes: 'Composable|Modifier|Shape|Color|Dp|BorderStroke|PaddingValues|RowScope|ColumnScope|MutableInteractionSource|InteractionSource|State|Boolean|Int|String|Unit|Surface|Row|Column|Box|MaterialTheme|ButtonColors|ButtonElevation|ButtonDefaults|CardColors|CardElevation|CardDefaults|TextFieldDefaults|ScaffoldDefaults|WindowInsets|FabPosition|SubcomposeLayout|BasicTextField|TextFieldState|TextFieldValue|Immutable|Stable',
  parts: [
    {id:1, title:'Slot API', sub:'å…ƒä»¶çš„éˆé­‚', icon:'ğŸ§©', xpRead:50, xpQuiz:100},
    {id:2, title:'Defaults ç‰©ä»¶', sub:'é›†ä¸­ç®¡ç†é è¨­å€¼', icon:'ğŸ­', xpRead:50, xpQuiz:100},
    {id:3, title:'@Immutable é…ç½®é¡åˆ¥', sub:'æ•ˆèƒ½å®ˆé–€å“¡', icon:'ğŸ”’', xpRead:50, xpQuiz:100},
    {id:4, title:'å‡½å¼é‡è¼‰', sub:'å‹åˆ¥å®‰å…¨çš„å¤šå‹', icon:'ğŸ”€', xpRead:50, xpQuiz:100},
    {id:5, title:'å§”è¨—åŸºç¤å…ƒä»¶', sub:'åˆ†å±¤æ¶æ§‹', icon:'ğŸ—ï¸', xpRead:50, xpQuiz:100},
    {id:6, title:'SubcomposeLayout', sub:'æ¸¬é‡ä¾è³´è§£æ–¹', icon:'ğŸ“', xpRead:50, xpQuiz:100}
  ],
  badges: [
    {id:'slot-master', name:'Slot å¤§å¸«', icon:'ğŸ§©', req:[1]},
    {id:'config-guru', name:'é…ç½®é”äºº', icon:'âš™ï¸', req:[2,3]},
    {id:'overload-pro', name:'é‡è¼‰å°ˆå®¶', icon:'ğŸ”€', req:[4]},
    {id:'arch-hero', name:'æ¶æ§‹è‹±é›„', icon:'ğŸ—ï¸', req:[5,6]},
    {id:'m3-expert', name:'M3 å…¨é€š', icon:'ğŸ†', req:[1,2,3,4,5,6]}
  ],
  defaultStateExtra: {
    part1Matches: {},
    part2Answer: null,
    part3Answers: [null, null, null, null],
    part4Order: [2,0,3,1],
    part5Matches: {},
    part6Order: [3,5,1,0,4,2]
  },
  initExtra: function() {}
};

// ============================================================
// PART 1: Slot API â€” å…ƒä»¶çš„éˆé­‚
// ============================================================
function getPart1() {
  var done = S.completedParts.includes(1);
  var read = S.readParts.includes(1);

  var h = '<div class="part-hdr"><span class="tag">Part 1</span><h1>ğŸ§© Slot API â€” å…ƒä»¶çš„éˆé­‚</h1>' +
    '<p class="desc">Slot API å°±åƒç‰†ä¸Šçš„ã€Œæ’åº§ã€ï¼šå…ƒä»¶å®šç¾©æ’åº§çš„å½¢ç‹€ï¼Œä½¿ç”¨è€…æ±ºå®šæ’å…¥ä»€éº¼ã€‚é€™æ˜¯ Material3 æœ€æ ¸å¿ƒçš„çµ„åˆæ¨¡å¼ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">æ’åº§èˆ‡æ’é ­çš„æ¯”å–»</h3>' +
    '<p style="margin-bottom:16px">å‚³çµ± UI æ¡†æ¶ç”¨<strong>ç¹¼æ‰¿</strong>æ“´å±•å…ƒä»¶ï¼ˆOverrideã€å­é¡åŒ–ï¼‰ï¼Œä½† Compose ç”¨<strong>çµ„åˆ</strong>â€”â€”æŠŠã€Œæ´ã€ç•™çµ¦å‘¼å«è€…å¡«å…¥ä»»æ„å…§å®¹ã€‚' +
    'é€™äº›ã€Œæ´ã€å°±æ˜¯ Slot åƒæ•¸ï¼Œå‹åˆ¥æ˜¯ <code>@Composable () -> Unit</code> æˆ–å…¶è®Šé«”ã€‚</p>' +
    '<h4 style="margin-bottom:8px">å››ç¨® Slot å±¤æ¬¡</h4>' +
    '<div class="param-group param-slot"><strong>1. ç„¡é™åˆ¶ Slot</strong>ï¼š<code>() -> Unit</code><br>' +
    '<span style="font-size:.85rem;color:var(--txt2)">å®Œå…¨è‡ªç”±çš„å…§å®¹æ³¨å…¥ï¼Œä½¿ç”¨è€…å¯ä»¥æ”¾å…¥ä»»ä½• Composable</span></div>' +
    '<div class="param-group param-slot"><strong>2. å¸¶ Scope Slot</strong>ï¼š<code>ColumnScope.() -> Unit</code><br>' +
    '<span style="font-size:.85rem;color:var(--txt2)">é™åˆ¶å‚ç›´ä½ˆå±€ APIï¼Œåªæœ‰ Column è£¡çš„ API å¯ç”¨ï¼ˆå¦‚ weightã€alignï¼‰</span></div>' +
    '<div class="param-group param-slot"><strong>3. å¸¶åƒæ•¸ Slot</strong>ï¼š<code>(PaddingValues) -> Unit</code><br>' +
    '<span style="font-size:.85rem;color:var(--txt2)">çˆ¶å±¤å‚³éè¨ˆç®—å€¼çµ¦å­å…ƒä»¶ï¼Œå¦‚ Scaffold çš„ content padding</span></div>' +
    '<div class="param-group param-slot"><strong>4. å¯é¸ Slot</strong>ï¼š<code>(() -> Unit)?</code><br>' +
    '<span style="font-size:.85rem;color:var(--txt2)">å¯é¸å…§å®¹æ³¨å…¥ï¼Œnull è¡¨ç¤ºä¸é¡¯ç¤ºè©²å€åŸŸ</span></div></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Scaffold çš„ Slot åƒæ•¸</h3>' +
    codeBlock('@Composable\\nfun Scaffold(\\n    modifier: Modifier = Modifier,\\n    topBar: @Composable () -> Unit = {},\\n    bottomBar: @Composable () -> Unit = {},\\n    snackbarHost: @Composable () -> Unit = {},\\n    floatingActionButton: @Composable () -> Unit = {},\\n    floatingActionButtonPosition: FabPosition = FabPosition.End,\\n    containerColor: Color = MaterialTheme.colorScheme.background,\\n    contentColor: Color = contentColorFor(containerColor),\\n    contentWindowInsets: WindowInsets = ScaffoldDefaults.contentWindowInsets,\\n    content: @Composable (PaddingValues) -> Unit,\\n)') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">æ³¨æ„ï¼š<code>topBar</code> ç­‰æ˜¯ç„¡é™åˆ¶ Slotï¼Œè€Œ <code>content</code> æ˜¯å¸¶åƒæ•¸ Slotâ€”â€”æ¥æ”¶ <code>PaddingValues</code>ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">TextField çš„å¯é¸ Slot åƒæ•¸</h3>' +
    codeBlock('label: @Composable (() -> Unit)? = null,\\nplaceholder: @Composable (() -> Unit)? = null,\\nleadingIcon: @Composable (() -> Unit)? = null,\\ntrailingIcon: @Composable (() -> Unit)? = null,\\nprefix: @Composable (() -> Unit)? = null,\\nsuffix: @Composable (() -> Unit)? = null,\\nsupportingText: @Composable (() -> Unit)? = null,') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">å…¨éƒ¨éƒ½æ˜¯å¯é¸ Slot <code>(() -> Unit)?</code>ï¼Œnull ä»£è¡¨ä¸æ¸²æŸ“ã€‚</p></div>';

  h += insightBlock(1, 'Compose ç”¨çµ„åˆå–ä»£ç¹¼æ‰¿ã€‚Material3 æ²’æœ‰ä¸€å€‹å…ƒä»¶æ˜¯é€éç¹¼æ‰¿ä¾†æ“´å±•çš„â€”â€”å…¨éƒ¨éƒ½æ˜¯å‡½å¼ + Slot çµ„åˆã€‚é€™ä¸æ˜¯å¶ç„¶ï¼Œè€Œæ˜¯åˆ»æ„çš„è¨­è¨ˆå“²å­¸ï¼šç¹¼æ‰¿å»ºç«‹çš„æ˜¯ã€Œis-aã€é—œä¿‚ï¼ˆä½ æ˜¯ä»€éº¼ï¼‰ï¼ŒSlot å»ºç«‹çš„æ˜¯ã€Œhas-aã€é—œä¿‚ï¼ˆä½ æœ‰ä»€éº¼ï¼‰ã€‚å¾Œè€…æ›´éˆæ´»ã€æ›´å®¹æ˜“æ¸¬è©¦ã€æ›´ä¸å®¹æ˜“ç”¢ç”Ÿè„†å¼±çš„é¡åˆ¥éšå±¤ã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(1)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var types = ['() -> Unit', 'ColumnScope.() -> Unit', '(PaddingValues) -> Unit', '(() -> Unit)?'];
  var scenarios = ['å®Œå…¨è‡ªç”±çš„å…§å®¹æ³¨å…¥', 'é™åˆ¶å‚ç›´ä½ˆå±€ API', 'çˆ¶å±¤å‚³éè¨ˆç®—å€¼', 'å¯é¸å…§å®¹æ³¨å…¥'];
  var keys = ['a', 'b', 'c', 'd'];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šSlot å‹åˆ¥é…å°</h3>' +
    '<p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">å°‡æ¯å€‹ Slot å‹åˆ¥é…å°åˆ°æ­£ç¢ºçš„ä½¿ç”¨æƒ…å¢ƒ</p>';
  keys.forEach(function(k, ki) {
    var sel = S.part1Matches[k];
    h += '<div class="quiz-row"><span class="quiz-tag" style="font-weight:700;background:var(--lav);color:#fff;cursor:default">' + types[ki] + '</span>' +
      '<select class="quiz-select" onchange="setPart1Match(\'' + k + '\',this.value)"' + (done ? ' disabled' : '') + '><option value="">â€” é¸æ“‡æƒ…å¢ƒ â€”</option>';
    scenarios.forEach(function(s, si) {
      h += '<option value="' + si + '"' + (sel == si ? ' selected' : '') + '>' + s + '</option>';
    });
    h += '</select></div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz1()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz1-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼æ‰€æœ‰ Slot å‹åˆ¥é…å°æ­£ç¢ºã€‚</div>';
  h += '</div>';

  h += briefCard(1, 'Slot API', [
    'Slot API æ˜¯ Compose çš„ã€Œçµ„åˆå–ä»£ç¹¼æ‰¿ã€å“²å­¸çš„æ ¸å¿ƒå¯¦è¸',
    'å››ç¨® Slot å±¤æ¬¡ï¼šç„¡é™åˆ¶ã€å¸¶ Scopeã€å¸¶åƒæ•¸ã€å¯é¸',
    'Material3 æ‰€æœ‰å…ƒä»¶éƒ½ç”¨ Slot è€Œéç¹¼æ‰¿ä¾†æ“´å±•åŠŸèƒ½'
  ], 'ç‚ºä»€éº¼ä¸ç›´æ¥ç”¨ View.addView() é‚£ç¨®æ–¹å¼ï¼Ÿ', 'View.addView() æ˜¯å‘½ä»¤å¼â€”â€”ä½ å‘Šè¨´ç³»çµ±ã€Œæ€éº¼åšã€ã€‚Slot API æ˜¯å®£å‘Šå¼â€”â€”ä½ æè¿°ã€Œè¦ä»€éº¼ã€ï¼ŒCompose å¹«ä½ çµ„åˆã€‚å®£å‘Šå¼æ›´å®¹æ˜“æ¨ç†ã€æ¸¬è©¦å’Œé‡ç”¨ã€‚');

  return h;
}

function setPart1Match(k, v) { S.part1Matches[k] = v === '' ? null : parseInt(v); save(); }
function checkQuiz1() {
  var correct = {a: 0, b: 1, c: 2, d: 3};
  var ok = Object.keys(correct).every(function(k) { return S.part1Matches[k] === correct[k]; });
  var el = document.getElementById('quiz1-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨æ­£ç¢ºï¼</div>'; completePart(1); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ æœ‰äº›é…å°ä¸æ­£ç¢ºï¼Œå†æƒ³æƒ³çœ‹ï¼</div>';
}

// ============================================================
// PART 2: Defaults ç‰©ä»¶ â€” é›†ä¸­ç®¡ç†é è¨­å€¼
// ============================================================
function getPart2() {
  var done = S.completedParts.includes(2);
  var read = S.readParts.includes(2);

  var h = '<div class="part-hdr"><span class="tag">Part 2</span><h1>ğŸ­ Defaults ç‰©ä»¶ â€” é›†ä¸­ç®¡ç†é è¨­å€¼</h1>' +
    '<p class="desc">ç‚ºä»€éº¼é è¨­å€¼ä¸ç›´æ¥å¯«åœ¨åƒæ•¸ä¸Šï¼Ÿå› ç‚ºå¾ˆå¤šé è¨­å€¼éœ€è¦ @Composable ç’°å¢ƒæ‰èƒ½å–å¾—ã€‚Defaults ç‰©ä»¶å°±æ˜¯è§£æ–¹ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ç‚ºä»€éº¼ä¸ç›´æ¥çµ¦é è¨­å€¼ï¼Ÿ</h3>' +
    '<p style="margin-bottom:12px">çœ‹é€™å€‹ä¾‹å­â€”â€”<code>CardDefaults.shape</code> çš„é è¨­å€¼ä¾†è‡ª <code>MaterialTheme</code>ï¼Œè€Œ <code>MaterialTheme</code> éœ€è¦ <code>@Composable</code> ç’°å¢ƒæ‰èƒ½è®€å–ï¼š</p>' +
    codeBlock('object CardDefaults {\\n    // éœ€è¦ @Composable æ‰èƒ½è®€å– theme token\\n    val shape: Shape @Composable get() = FilledCardTokens.ContainerShape.value\\n}') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">Kotlin å‡½å¼åƒæ•¸çš„é è¨­å€¼ä¸èƒ½æ˜¯ <code>@Composable</code> çš„ï¼Œæ‰€ä»¥å¿…é ˆç”¨ Defaults ç‰©ä»¶åŒ…è£ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">CardDefaults å®Œæ•´ç¨‹å¼ç¢¼</h3>' +
    codeBlock('object CardDefaults {\\n    val shape: Shape @Composable get() = FilledCardTokens.ContainerShape.value\\n\\n    @Composable\\n    fun cardElevation(\\n        defaultElevation: Dp = FilledCardTokens.ContainerElevation,\\n        pressedElevation: Dp = FilledCardTokens.PressedContainerElevation,\\n        focusedElevation: Dp = FilledCardTokens.FocusContainerElevation,\\n        hoveredElevation: Dp = FilledCardTokens.HoverContainerElevation,\\n        draggedElevation: Dp = FilledCardTokens.DraggedContainerElevation,\\n        disabledElevation: Dp = FilledCardTokens.DisabledContainerElevation,\\n    ): CardElevation = CardElevation(...)\\n\\n    @Composable\\n    fun cardColors() = MaterialTheme.colorScheme.defaultCardColors\\n}') +
    '</div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ã€Œåªæ”¹ä½ è¦æ”¹çš„ã€æ¨¡å¼</h3>' +
    '<p style="margin-bottom:12px">ä½¿ç”¨è€…åªéœ€è¦è¦†è“‹è‡ªå·±é—œå¿ƒçš„å±¬æ€§ï¼Œå…¶ä»–ç¶­æŒä¸»é¡Œé è¨­å€¼ï¼š</p>' +
    codeBlock('// åªæ”¹ elevationï¼Œå…¶ä»–ç¶­æŒé è¨­\\nCard(\\n    elevation = CardDefaults.cardElevation(\\n        defaultElevation = 8.dp  // åªæ”¹é€™ä¸€å€‹\\n        // å…¶ä»– 5 å€‹ elevation ç¶­æŒä¸»é¡Œé è¨­å€¼\\n    )\\n) {\\n    Text("Hello")\\n}') +
    '</div>';

  h += insightBlock(2, 'Defaults ç‰©ä»¶æœ¬è³ªä¸Šæ˜¯å·¥å» æ¨¡å¼ï¼ˆFactory Patternï¼‰ã€‚å®ƒå°è£äº† @Composable ä¾è³´â€”â€”ä½¿ç”¨è€…ä¸éœ€è¦çŸ¥é“é è¨­çš„ shape ä¾†è‡ª FilledCardTokens.ContainerShape.valueï¼Œåªéœ€è¦å‘¼å« CardDefaults.shape å°±å¥½ã€‚é€™ä¹Ÿè®“ Material3 èƒ½å¤ çµ±ä¸€æ›´æ–°æ‰€æœ‰å…ƒä»¶çš„é è¨­å€¼ï¼Œåªè¦æ”¹ Token å°±è¡Œã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(2)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var opts = [
    {code: 'Card(\n  colors = CardDefaults.cardColors(),\n  elevation = CardDefaults.cardElevation(\n    defaultElevation = 8.dp\n  )\n)', label: 'ä½¿ç”¨ Defaults å·¥å»  + åªè¦†è“‹éœ€è¦çš„å€¼'},
    {code: 'Card(\n  containerColor = Color.Red\n)', label: 'Card æ²’æœ‰ containerColor åƒæ•¸'},
    {code: 'Card(\n  colors = CardColors(\n    Color.Red, Color.White,\n    Color.Gray, Color.Gray\n  )\n)', label: 'ç›´æ¥å»ºæ§‹ï¼Œä¸ç”¨å·¥å» æ–¹æ³•'},
    {code: 'Card(\n  colors = MaterialTheme\n    .colorScheme.cardColors()\n)', label: 'colorScheme æ²’æœ‰ cardColors()'}
  ];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šå“ªå€‹æ­£ç¢ºä½¿ç”¨ Defaultsï¼Ÿ</h3>' +
    '<p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">é¸å‡ºæ­£ç¢ºä½¿ç”¨ CardDefaults çš„å¯«æ³•</p>';
  opts.forEach(function(o, i) {
    var sel = S.part2Answer === i;
    h += '<div class="quiz-opt' + (sel ? ' selected' : '') + '" onclick="setPart2(' + i + ')"' + (done ? ' style="pointer-events:none"' : '') + '>' +
      String.fromCharCode(65 + i) + '. ' + o.label + codeBlock(o.code.replace(/\n/g, '\\n')) + '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz2()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz2-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼æ­£ç¢ºä½¿ç”¨ Defaults å·¥å» æ–¹æ³•ã€‚</div>';
  h += '</div>';

  h += briefCard(2, 'Defaults ç‰©ä»¶', [
    'Defaults æ˜¯å·¥å» æ¨¡å¼ï¼Œå°è£ @Composable ä¾è³´',
    'ä½¿ç”¨è€…åªè¦†è“‹éœ€è¦çš„å±¬æ€§ï¼Œå…¶ä»–ç¶­æŒä¸»é¡Œé è¨­å€¼',
    'çµ±ä¸€çš„ Defaults è®“ Material3 èƒ½é›†ä¸­ç®¡ç†æ‰€æœ‰é è¨­å€¼'
  ], 'ç‚ºä»€éº¼ä¸æŠŠé è¨­å€¼ç›´æ¥å¯«åœ¨ Card() åƒæ•¸ä¸Šï¼Ÿ', 'å› ç‚º shapeã€colors ç­‰é è¨­å€¼ä¾†è‡ª MaterialThemeï¼Œéœ€è¦ @Composable ç’°å¢ƒã€‚Kotlin å‡½å¼åƒæ•¸çš„é è¨­å€¼ä¸èƒ½æ˜¯ @Composable çš„ï¼Œæ‰€ä»¥å¿…é ˆç”¨ Defaults ç‰©ä»¶ã€‚');

  return h;
}

function setPart2(i) { S.part2Answer = i; save(); render(); }
function checkQuiz2() {
  var el = document.getElementById('quiz2-result');
  if (S.part2Answer === 0) {
    el.innerHTML = '<div class="quiz-result pass">ğŸ‰ æ­£ç¢ºï¼ä½¿ç”¨ CardDefaults å·¥å» æ–¹æ³• + åªè¦†è“‹éœ€è¦æ”¹çš„å€¼ã€‚</div>';
    completePart(2);
  } else {
    var hints = ['', 'Card æ²’æœ‰ containerColor é€™å€‹é ‚å±¤åƒæ•¸ï¼Œé¡è‰²è¦é€é CardDefaults.cardColors() å‚³å…¥ã€‚', 'ç›´æ¥å»ºæ§‹ CardColors æœƒå¤±å»ä¸»é¡Œæ•´åˆï¼Œè€Œä¸”ä¸å¤ èªç¾©åŒ–ã€‚', 'MaterialTheme.colorScheme æ²’æœ‰ cardColors() æ–¹æ³•ï¼Œé¡è‰²ç”± CardDefaults ç®¡ç†ã€‚'];
    el.innerHTML = '<div class="quiz-result fail">âŒ ' + (hints[S.part2Answer] || 'å†æƒ³æƒ³çœ‹ï¼') + '</div>';
  }
}

// ============================================================
// PART 3: @Immutable é…ç½®é¡åˆ¥ â€” æ•ˆèƒ½å®ˆé–€å“¡
// ============================================================
function getPart3() {
  var done = S.completedParts.includes(3);
  var read = S.readParts.includes(3);

  var h = '<div class="part-hdr"><span class="tag">Part 3</span><h1>ğŸ”’ @Immutable é…ç½®é¡åˆ¥ â€” æ•ˆèƒ½å®ˆé–€å“¡</h1>' +
    '<p class="desc">Compose çš„ Recomposition æ©Ÿåˆ¶éœ€è¦çŸ¥é“ã€Œä»€éº¼è®Šäº†ã€ã€‚@Immutable å’Œæ­£ç¢ºçš„ equals/hashCode å°±æ˜¯æ•ˆèƒ½çš„é—œéµã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Recomposition è§¸ç™¼æ¢ä»¶</h3>' +
    '<p style="margin-bottom:12px">Compose åœ¨æ¯æ¬¡ Recomposition æ™‚ï¼Œæœƒæ¯”è¼ƒåƒæ•¸æ˜¯å¦ã€Œç›¸ç­‰ã€ã€‚å¦‚æœæ‰€æœ‰åƒæ•¸éƒ½ç›¸ç­‰ï¼Œå°±<strong>è·³é</strong>è©² Composable çš„é‡çµ„ã€‚</p>' +
    '<p style="margin-bottom:12px">é—œéµå•é¡Œï¼šCompose æ€éº¼çŸ¥é“ä¸€å€‹ç‰©ä»¶æœ‰æ²’æœ‰è®Šï¼Ÿ</p>' +
    '<div class="param-group param-behavior"><strong>æ²’æœ‰ @Immutable</strong>ï¼šCompose ä¸ç¢ºå®šç‰©ä»¶æ˜¯å¦æœƒè®Šï¼Œæ¯æ¬¡éƒ½è§¸ç™¼ Recomposition</div>' +
    '<div class="param-group param-style"><strong>æœ‰ @Immutable</strong>ï¼šCompose ä¿¡ä»»ã€Œé€™å€‹ç‰©ä»¶å»ºç«‹å¾Œä¸æœƒè®Šã€ï¼Œåªç”¨ equals() æ¯”è¼ƒ</div></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">CardColors å®Œæ•´å¯¦ä½œ</h3>' +
    codeBlock('@Immutable\\nclass CardColors constructor(\\n    val containerColor: Color,\\n    val contentColor: Color,\\n    val disabledContainerColor: Color,\\n    val disabledContentColor: Color,\\n) {\\n    fun copy(...) = CardColors(...)\\n\\n    @Stable\\n    internal fun containerColor(enabled: Boolean): Color =\\n        if (enabled) containerColor else disabledContainerColor\\n\\n    @Stable\\n    internal fun contentColor(enabled: Boolean): Color =\\n        if (enabled) contentColor else disabledContentColor\\n\\n    override fun equals(other: Any?): Boolean {\\n        if (this === other) return true\\n        if (other == null || other !is CardColors) return false\\n        if (containerColor != other.containerColor) return false\\n        if (contentColor != other.contentColor) return false\\n        if (disabledContainerColor != other.disabledContainerColor) return false\\n        if (disabledContentColor != other.disabledContentColor) return false\\n        return true\\n    }\\n\\n    override fun hashCode(): Int { ... }\\n}') +
    '</div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ä¸‰å¤§é‡é»</h3>' +
    '<div class="param-group param-modifier"><strong>@Immutable</strong>ï¼šå‘Šè¨´ Compose é€™å€‹é¡åˆ¥å»ºç«‹å¾Œæ‰€æœ‰å±¬æ€§ä¸æœƒæ”¹è®Šï¼ˆå…¨éƒ¨æ˜¯ <code>val</code>ï¼‰</div>' +
    '<div class="param-group param-style"><strong>equals/hashCode</strong>ï¼šè®“ Compose èƒ½æ­£ç¢ºæ¯”è¼ƒã€Œæ–°èˆŠç‰©ä»¶æ˜¯å¦ç›¸åŒã€ï¼Œé¿å…ä¸å¿…è¦çš„ Recomposition</div>' +
    '<div class="param-group param-slot"><strong>copy()</strong>ï¼šå»ºç«‹æ–°ç‰©ä»¶è€Œéä¿®æ”¹åŸå§‹ç‰©ä»¶â€”â€”ä¸å¯è®Šæ€§çš„æ¨™æº–æ“ä½œ</div></div>';

  h += insightBlock(3, '<strong>@Stable vs @Immutable å·®ç•°</strong>ï¼š@Immutable æ›´åš´æ ¼â€”â€”æ‰€æœ‰å±¬æ€§æ°¸é ä¸è®Šã€‚@Stable å‰‡å…è¨±å±¬æ€§å¯è®Šï¼Œä½†è¦æ±‚ï¼š(1) å° equals çš„çµæœæ°¸é ä¸€è‡´ï¼Œ(2) å±¬æ€§è®ŠåŒ–æ™‚æœƒé€šçŸ¥ Composeï¼ˆå¦‚ MutableStateï¼‰ã€‚CardColors ç”¨ @Immutable å› ç‚ºå®ƒæ‰€æœ‰å±¬æ€§éƒ½æ˜¯ valï¼›è€Œ MutableInteractionSource ç”¨ @Stable å› ç‚ºå®ƒçš„ç‹€æ…‹æœƒè®Šä½†æœƒé€šçŸ¥ç³»çµ±ã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(3)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var tfQ = [
    {text: '@Immutable çš„æ‰€æœ‰å±¬æ€§å¿…é ˆæ˜¯ val', ans: true},
    {text: 'ä¸å¯¦ä½œ equals() ä¸å½±éŸ¿ Recomposition æ•ˆèƒ½', ans: false},
    {text: 'CardColors çš„ copy() æœƒä¿®æ”¹åŸå§‹ç‰©ä»¶', ans: false},
    {text: '@Stable å’Œ @Immutable å®Œå…¨ç›¸åŒ', ans: false}
  ];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šæ˜¯éé¡Œ</h3>';
  tfQ.forEach(function(q, i) {
    var a = S.part3Answers[i];
    h += '<div class="tf-row"><span class="tf-code">' + q.text + '</span><div class="tf-btns">' +
      '<button class="tf-btn' + (a === true ? ' sel-t' : '') + '" onclick="setPart3(' + i + ',true)"' + (done ? ' disabled' : '') + '>â­• å°</button>' +
      '<button class="tf-btn' + (a === false ? ' sel-f' : '') + '" onclick="setPart3(' + i + ',false)"' + (done ? ' disabled' : '') + '>âŒ éŒ¯</button></div></div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz3()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz3-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ å·²æŒæ¡ @Immutable çš„æ ¸å¿ƒæ¦‚å¿µã€‚</div>';
  h += '</div>';

  h += briefCard(3, '@Immutable é…ç½®é¡åˆ¥', [
    '@Immutable å‘Šè¨´ Composeã€Œé€™å€‹ç‰©ä»¶ä¸æœƒè®Šã€ï¼Œé¿å…ä¸å¿…è¦çš„ Recomposition',
    'equals/hashCode è®“ Compose æ­£ç¢ºæ¯”è¼ƒæ–°èˆŠç‰©ä»¶',
    'copy() å»ºç«‹æ–°ç‰©ä»¶ï¼Œä¸ä¿®æ”¹åŸå§‹ç‰©ä»¶â€”â€”ä¸å¯è®Šæ€§çš„æ¨™æº–æ“ä½œ'
  ], 'ä¸åŠ  @Immutable æœƒæ€æ¨£ï¼Ÿ', 'Compose ç„¡æ³•ç¢ºå®šç‰©ä»¶æ˜¯å¦æœƒè®Šï¼Œæ¯æ¬¡ Recomposition éƒ½æœƒé‡æ–°åŸ·è¡Œè©² Composableï¼Œå³ä½¿åƒæ•¸æ²’è®Šã€‚åœ¨è¤‡é›œ UI ä¸­é€™æœƒå°è‡´æ˜é¡¯çš„æ•ˆèƒ½ä¸‹é™ã€‚');

  return h;
}

function setPart3(i, v) { S.part3Answers[i] = v; save(); render(); }
function checkQuiz3() {
  var ans = [true, false, false, false];
  var ok = ans.every(function(a, i) { return S.part3Answers[i] === a; });
  var el = document.getElementById('quiz3-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨æ­£ç¢ºï¼</div>'; completePart(3); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ æœ‰äº›åˆ¤æ–·ä¸æ­£ç¢ºã€‚æç¤ºï¼š@Immutable ä¿è­‰æ‰€æœ‰å±¬æ€§æ˜¯ valã€equals å½±éŸ¿ Recompositionã€copy å»ºç«‹æ–°ç‰©ä»¶ã€‚</div>';
}

// ============================================================
// PART 4: å‡½å¼é‡è¼‰ â€” å‹åˆ¥å®‰å…¨çš„å¤šå‹
// ============================================================
function getPart4() {
  var done = S.completedParts.includes(4);
  var read = S.readParts.includes(4);

  var h = '<div class="part-hdr"><span class="tag">Part 4</span><h1>ğŸ”€ å‡½å¼é‡è¼‰ â€” å‹åˆ¥å®‰å…¨çš„å¤šå‹</h1>' +
    '<p class="desc">åŒä¸€å€‹å…ƒä»¶åç¨±ï¼Œä¸åŒçš„åƒæ•¸ç°½åã€‚Material3 ç”¨å‡½å¼é‡è¼‰å¯¦ç¾å‹åˆ¥å®‰å…¨çš„å¤šå‹ï¼Œè€Œé Boolean flagã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">å•é¡Œï¼šBoolean flag çš„é™·é˜±</h3>' +
    '<p style="margin-bottom:12px">å¦‚æœç”¨ Boolean flag ä¾†å€åˆ†å¯é»æ“Šå’Œä¸å¯é»æ“Šçš„ Cardï¼š</p>' +
    codeBlock('// ç³Ÿç³•çš„è¨­è¨ˆâ€”â€”Boolean flag\\nfun Card(\\n    clickable: Boolean = false,\\n    onClick: (() -> Unit)? = null, // clickable=false æ™‚é€™å€‹åƒæ•¸ç„¡æ„ç¾©\\n    ...\\n)\\n\\n// å±éšªï¼šclickable=true ä½†å¿˜äº†å‚³ onClick\\nCard(clickable = true) { ... }  // ç·¨è­¯é€šéï¼Œä½†åŸ·è¡Œæ™‚æ²’åæ‡‰ï¼') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">Boolean flag æŠŠéŒ¯èª¤æ¨é²åˆ°åŸ·è¡Œæ™‚ã€‚å‡½å¼é‡è¼‰åœ¨ç·¨è­¯æœŸå°±èƒ½ç™¼ç¾å•é¡Œã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Card çš„å…©å€‹é‡è¼‰</h3>' +
    '<div class="accordion"><button class="acc-head" onclick="toggleAcc(this)"><span>éœæ…‹ç‰ˆ Cardï¼ˆä¸å¯é»æ“Šï¼‰</span><span class="arrow">â–¼</span></button>' +
    '<div class="acc-body"><div class="acc-inner">' +
    codeBlock('@Composable\\nfun Card(\\n    modifier: Modifier = Modifier,\\n    shape: Shape = CardDefaults.shape,\\n    colors: CardColors = CardDefaults.cardColors(),\\n    elevation: CardElevation = CardDefaults.cardElevation(),\\n    border: BorderStroke? = null,\\n    content: @Composable ColumnScope.() -> Unit,\\n) {\\n    Surface(\\n        modifier = modifier,\\n        shape = shape,\\n        color = colors.containerColor(enabled = true),\\n        contentColor = colors.contentColor(enabled = true),\\n        shadowElevation = elevation.shadowElevation(\\n            enabled = true, interactionSource = null\\n        ).value,\\n        border = border,\\n    ) {\\n        Column(content = content)\\n    }\\n}') +
    '</div></div></div>' +
    '<div class="accordion"><button class="acc-head" onclick="toggleAcc(this)"><span>å¯é»æ“Šç‰ˆ Cardï¼ˆonClick å¿…å¡«ï¼‰</span><span class="arrow">â–¼</span></button>' +
    '<div class="acc-body"><div class="acc-inner">' +
    codeBlock('@Composable\\nfun Card(\\n    onClick: () -> Unit,\\n    modifier: Modifier = Modifier,\\n    enabled: Boolean = true,\\n    shape: Shape = CardDefaults.shape,\\n    colors: CardColors = CardDefaults.cardColors(),\\n    elevation: CardElevation = CardDefaults.cardElevation(),\\n    border: BorderStroke? = null,\\n    interactionSource: MutableInteractionSource? = null,\\n    content: @Composable ColumnScope.() -> Unit,\\n)') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">onClick æ˜¯ç¬¬ä¸€å€‹åƒæ•¸ä¸”ç„¡é è¨­å€¼â€”â€”å¼·åˆ¶å‘¼å«è€…æä¾›é»æ“Šè™•ç†ã€‚</p>' +
    '</div></div></div></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">TextField çš„ä¸‰å€‹é‡è¼‰</h3>' +
    codeBlock('// é‡è¼‰ 1ï¼šString ç‰ˆ\\nfun TextField(\\n    value: String,\\n    onValueChange: (String) -> Unit, ...\\n)\\n\\n// é‡è¼‰ 2ï¼šTextFieldValue ç‰ˆï¼ˆå«æ¸¸æ¨™ä½ç½®ç­‰å…ƒè³‡æ–™ï¼‰\\nfun TextField(\\n    value: TextFieldValue,\\n    onValueChange: (TextFieldValue) -> Unit, ...\\n)\\n\\n// é‡è¼‰ 3ï¼šTextFieldState ç‰ˆï¼ˆç‹€æ…‹ç®¡ç†å…§å»ºï¼‰\\nfun TextField(\\n    state: TextFieldState, ...\\n)') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">ä¸‰å€‹ç‰ˆæœ¬å…±ç”¨ TextField åç¨±ï¼Œä½†å‹åˆ¥ç³»çµ±ä¿è­‰ä½ ä¸æœƒæ··ç”¨ã€‚</p></div>';

  h += insightBlock(4, 'å‡½å¼é‡è¼‰æ¯” Boolean flag å¥½åœ¨å“ªï¼Ÿ<strong>ç·¨è­¯æœŸå‹åˆ¥å®‰å…¨</strong>ã€‚Boolean flag è®“éŒ¯èª¤åœ¨åŸ·è¡Œæ™‚æ‰çˆ†ç™¼ï¼ˆä¾‹å¦‚å¿˜äº†å‚³ onClickï¼‰ï¼Œè€Œå‡½å¼é‡è¼‰åœ¨ç·¨è­¯æ™‚å°±å ±éŒ¯â€”â€”å¯é»æ“Šç‰ˆçš„ onClick æ˜¯å¿…å¡«åƒæ•¸ï¼Œä¸å‚³å°±ç„¡æ³•ç·¨è­¯ã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(4)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var labels = [
    'Map<String, Any> å‚³åƒæ•¸',
    'Boolean flag æ§åˆ¶',
    'sealed class å€åˆ†',
    'å‡½å¼é‡è¼‰ï¼ˆMaterial3 åšæ³•ï¼‰'
  ];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šå¾æœ€ä¸å®‰å…¨åˆ°æœ€å®‰å…¨æ’åº</h3>' +
    '<p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">ç”¨ â–² â–¼ æŒ‰éˆ•æŠŠæ–¹æ¡ˆå¾æœ€ä¸å®‰å…¨ï¼ˆä¸Šï¼‰æ’åˆ°æœ€å®‰å…¨ï¼ˆä¸‹ï¼‰</p>';
  S.part4Order.forEach(function(idx, pos) {
    h += '<div class="sort-item"><span class="num">' + (pos + 1) + '</span><span class="text">' + labels[idx] + '</span>' +
      (!done ? '<button class="sort-btn" onclick="movePart4(' + pos + ',-1)">â–²</button><button class="sort-btn" onclick="movePart4(' + pos + ',1)">â–¼</button>' : '') +
      '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz4()" style="margin-top:16px">ç¢ºèªé †åº</button>';
  h += '<div id="quiz4-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ æŒæ¡äº†å‹åˆ¥å®‰å…¨çš„å±¤æ¬¡ã€‚</div>';
  h += '</div>';

  h += briefCard(4, 'å‡½å¼é‡è¼‰', [
    'Material3 ç”¨å‡½å¼é‡è¼‰å–ä»£ Boolean flagï¼Œå¯¦ç¾ç·¨è­¯æœŸå‹åˆ¥å®‰å…¨',
    'Card æœ‰éœæ…‹ç‰ˆå’Œå¯é»æ“Šç‰ˆå…©å€‹é‡è¼‰ï¼ŒTextField æœ‰ä¸‰å€‹é‡è¼‰',
    'é‡è¼‰è®“ä¸åˆæ³•çš„ç‹€æ…‹åœ¨ç·¨è­¯æ™‚å°±è¢«æ‹’çµ•ï¼Œè€Œéç­‰åˆ°åŸ·è¡Œæ™‚'
  ], 'é‡è¼‰æœƒä¸æœƒé€ æˆ API æ··äº‚ï¼Ÿ', 'ä¸æœƒã€‚IDE çš„è‡ªå‹•å®Œæˆæœƒæ ¹æ“šä½ å‚³å…¥çš„åƒæ•¸è‡ªå‹•é¸æ“‡æ­£ç¢ºçš„é‡è¼‰ã€‚å°ä½¿ç”¨è€…ä¾†èªªï¼Œæ„Ÿè¦ºå°±åƒåŒä¸€å€‹å‡½å¼æ ¹æ“šæƒ…å¢ƒè‡ªå‹•é©é…ã€‚');

  return h;
}

function movePart4(pos, dir) {
  var np = pos + dir;
  if (np < 0 || np >= S.part4Order.length) return;
  var tmp = S.part4Order[pos];
  S.part4Order[pos] = S.part4Order[np];
  S.part4Order[np] = tmp;
  save(); render();
}
function checkQuiz4() {
  var ok = S.part4Order.every(function(v, i) { return v === i; });
  var el = document.getElementById('quiz4-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ æ’åºæ­£ç¢ºï¼å¾ Map åˆ°å‡½å¼é‡è¼‰ï¼Œå‹åˆ¥å®‰å…¨é€æ­¥æå‡ã€‚</div>'; completePart(4); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ é †åºä¸å°ã€‚æç¤ºï¼šMap æ²’æœ‰å‹åˆ¥æª¢æŸ¥æœ€ä¸å®‰å…¨ï¼Œå‡½å¼é‡è¼‰æœ‰ç·¨è­¯æœŸä¿éšœæœ€å®‰å…¨ã€‚</div>';
}

// ============================================================
// PART 5: å§”è¨—åŸºç¤å…ƒä»¶ â€” åˆ†å±¤æ¶æ§‹
// ============================================================
function getPart5() {
  var done = S.completedParts.includes(5);
  var read = S.readParts.includes(5);

  var h = '<div class="part-hdr"><span class="tag">Part 5</span><h1>ğŸ—ï¸ å§”è¨—åŸºç¤å…ƒä»¶ â€” åˆ†å±¤æ¶æ§‹</h1>' +
    '<p class="desc">Material3 çš„å…ƒä»¶ä¸æ˜¯å¾é›¶é–‹å§‹å»ºæ§‹ï¼Œè€Œæ˜¯ä¸€å±¤å±¤å§”è¨—ä¸‹å»ã€‚æ¯ä¸€å±¤åªåšè‡ªå·±çš„äº‹ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ä¸‰å±¤æ¶æ§‹åœ–</h3>' +
    '<div class="layer-diagram">' +
    '<div class="layer-box layer-api">èªç¾©å±¤ï¼ˆAPI å±¤ï¼‰<div style="font-size:.75rem;margin-top:4px">ElevatedButtonã€FilledCardã€OutlinedTextField</div></div>' +
    '<div class="layer-arrow">â†“ å§”è¨—</div>' +
    '<div class="layer-box layer-base">è¡Œç‚ºå±¤ï¼ˆåŸºç¤å…ƒä»¶ï¼‰<div style="font-size:.75rem;margin-top:4px">Buttonã€Cardã€TextField</div></div>' +
    '<div class="layer-arrow">â†“ å§”è¨—</div>' +
    '<div class="layer-box layer-layout">ä½ˆå±€å±¤ï¼ˆåº•å±¤åŸèªï¼‰<div style="font-size:.75rem;margin-top:4px">Surfaceã€Rowã€Columnã€BasicTextFieldã€SubcomposeLayout</div></div>' +
    '</div></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Card å§”è¨— Surface + Column</h3>' +
    codeBlock('@Composable\\nfun Card(\\n    modifier: Modifier = Modifier,\\n    shape: Shape = CardDefaults.shape,\\n    colors: CardColors = CardDefaults.cardColors(),\\n    elevation: CardElevation = CardDefaults.cardElevation(),\\n    border: BorderStroke? = null,\\n    content: @Composable ColumnScope.() -> Unit,\\n) {\\n    Surface(\\n        modifier = modifier,\\n        shape = shape,\\n        color = colors.containerColor(enabled = true),\\n        contentColor = colors.contentColor(enabled = true),\\n        shadowElevation = elevation.shadowElevation(\\n            enabled = true, interactionSource = null\\n        ).value,\\n        border = border,\\n    ) {\\n        Column(content = content)\\n    }\\n}') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">Card = Surfaceï¼ˆè™•ç†å½¢ç‹€ã€é¡è‰²ã€é™°å½±ï¼‰ + Columnï¼ˆå‚ç›´æ’åˆ—å…§å®¹ï¼‰</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Button å§”è¨— Surface + Row</h3>' +
    codeBlock('@Composable\\nfun Button(\\n    onClick: () -> Unit,\\n    modifier: Modifier = Modifier,\\n    enabled: Boolean = true,\\n    shape: Shape = ButtonDefaults.shape,\\n    colors: ButtonColors = ButtonDefaults.buttonColors(),\\n    elevation: ButtonElevation? = ButtonDefaults.buttonElevation(),\\n    border: BorderStroke? = null,\\n    contentPadding: PaddingValues = ButtonDefaults.ContentPadding,\\n    interactionSource: MutableInteractionSource? = null,\\n    content: @Composable RowScope.() -> Unit\\n) {\\n    val containerColor = colors.containerColor(enabled)\\n    val contentColor = colors.contentColor(enabled)\\n    Surface(\\n        onClick = onClick,\\n        modifier = modifier.semantics { role = Role.Button },\\n        enabled = enabled,\\n        shape = shape,\\n        color = containerColor,\\n        contentColor = contentColor,\\n        shadowElevation = elevation?.shadowElevation(\\n            enabled, interactionSource\\n        )?.value ?: 0.dp,\\n        border = border,\\n        interactionSource = interactionSource,\\n    ) {\\n        ProvideContentColorTextStyle(\\n            contentColor = contentColor,\\n            textStyle = MaterialTheme.typography.labelLarge\\n        ) {\\n            Row(\\n                Modifier.defaultMinSize(\\n                    minWidth = ButtonDefaults.MinWidth,\\n                    minHeight = ButtonDefaults.MinHeight\\n                ).padding(contentPadding),\\n                horizontalArrangement = Arrangement.Center,\\n                verticalAlignment = Alignment.CenterVertically,\\n                content = content\\n            )\\n        }\\n    }\\n}') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">Button = Surfaceï¼ˆè™•ç†é»æ“Šã€å½¢ç‹€ã€é¡è‰²ï¼‰ + Rowï¼ˆæ°´å¹³æ’åˆ—åœ–ç¤ºå’Œæ–‡å­—ï¼‰</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">ElevatedButton ä¸€è¡Œå§”è¨— Button</h3>' +
    codeBlock('@Composable\\nfun ElevatedButton(\\n    onClick: () -> Unit,\\n    modifier: Modifier = Modifier,\\n    enabled: Boolean = true,\\n    shape: Shape = ButtonDefaults.elevatedShape,\\n    colors: ButtonColors = ButtonDefaults.elevatedButtonColors(),\\n    elevation: ButtonElevation? = ButtonDefaults.elevatedButtonElevation(),\\n    border: BorderStroke? = null,\\n    contentPadding: PaddingValues = ButtonDefaults.ContentPadding,\\n    interactionSource: MutableInteractionSource? = null,\\n    content: @Composable RowScope.() -> Unit\\n) = Button(\\n    onClick, modifier, enabled, shape, colors, elevation,\\n    border, contentPadding, interactionSource, content\\n)') +
    '<p style="font-size:.85rem;color:var(--txt2);margin-top:8px">å®Œæ•´å¯¦ä½œåªæœ‰ä¸€è¡Œï¼åªæ˜¯ç”¨ä¸åŒçš„ Defaults å€¼å‘¼å« Buttonã€‚</p></div>';

  h += insightBlock(5, 'ElevatedButton çš„å®Œæ•´å¯¦ä½œçœŸçš„åªæœ‰ä¸€è¡Œâ€”â€”<code>= Button(...)</code>ã€‚å·®ç•°åªåœ¨ Defaults å€¼ï¼š<code>ButtonDefaults.elevatedShape</code>ã€<code>elevatedButtonColors()</code>ã€<code>elevatedButtonElevation()</code>ã€‚é€™èªªæ˜äº† Defaults ç‰©ä»¶æ¨¡å¼ï¼ˆPart 2ï¼‰å’Œå§”è¨—æ¨¡å¼çš„å®Œç¾æ­é…â€”â€”æ”¹ä¸€çµ„é è¨­å€¼å°±èƒ½ã€Œè®Šå‡ºã€æ–°å…ƒä»¶ã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(5)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var components = ['Card', 'Button', 'ElevatedButton', 'Scaffold', 'TextField'];
  var bases = ['Surface + Column', 'Surface + Row', 'Button', 'SubcomposeLayout', 'BasicTextField'];
  var keys5 = ['a', 'b', 'c', 'd', 'e'];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šå…ƒä»¶é…å°åŸºç¤å…ƒä»¶</h3>' +
    '<p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">å°‡æ¯å€‹ M3 å…ƒä»¶é…å°åˆ°å®ƒå§”è¨—çš„åŸºç¤å…ƒä»¶</p>';
  keys5.forEach(function(k, ki) {
    var sel = S.part5Matches[k];
    h += '<div class="quiz-row"><span class="quiz-tag" style="font-weight:700;background:var(--lav);color:#fff;cursor:default">' + components[ki] + '</span>' +
      '<select class="quiz-select" onchange="setPart5Match(\'' + k + '\',this.value)"' + (done ? ' disabled' : '') + '><option value="">â€” é¸æ“‡åŸºç¤å…ƒä»¶ â€”</option>';
    bases.forEach(function(b, bi) {
      h += '<option value="' + bi + '"' + (sel == bi ? ' selected' : '') + '>' + b + '</option>';
    });
    h += '</select></div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz5()" style="margin-top:16px">ç¢ºèªç­”æ¡ˆ</button>';
  h += '<div id="quiz5-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ å·²æŒæ¡ M3 çš„åˆ†å±¤å§”è¨—æ¶æ§‹ã€‚</div>';
  h += '</div>';

  h += briefCard(5, 'å§”è¨—åŸºç¤å…ƒä»¶', [
    'Material3 å…ƒä»¶åˆ†ä¸‰å±¤ï¼šèªç¾©å±¤ â†’ è¡Œç‚ºå±¤ â†’ ä½ˆå±€å±¤',
    'Card = Surface + Columnï¼ŒButton = Surface + Row',
    'ElevatedButton åªæ˜¯ç”¨ä¸åŒ Defaults å€¼å§”è¨— Buttonâ€”â€”ä¸€è¡Œå®Œæˆ'
  ], 'ç‚ºä»€éº¼ä¸ç›´æ¥åœ¨ ElevatedButton è£¡å¯« Surfaceï¼Ÿ', 'å› ç‚º Button å·²ç¶“è™•ç†äº†æ‰€æœ‰é‚è¼¯ï¼ˆsemanticsã€contentColorã€typographyï¼‰ã€‚ElevatedButton çš„å·®ç•°åªåœ¨å¤–è§€ï¼Œä¸åœ¨è¡Œç‚ºã€‚å§”è¨—é¿å…äº†é‚è¼¯é‡è¤‡ã€‚');

  return h;
}

function setPart5Match(k, v) { S.part5Matches[k] = v === '' ? null : parseInt(v); save(); }
function checkQuiz5() {
  var correct = {a: 0, b: 1, c: 2, d: 3, e: 4};
  var ok = Object.keys(correct).every(function(k) { return S.part5Matches[k] === correct[k]; });
  var el = document.getElementById('quiz5-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ å…¨éƒ¨æ­£ç¢ºï¼</div>'; completePart(5); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ æœ‰äº›é…å°ä¸æ­£ç¢ºã€‚æç¤ºï¼šçœ‹çœ‹åŸå§‹ç¢¼ä¸­æ¯å€‹å…ƒä»¶çš„å‡½å¼é«”å…§å‘¼å«äº†ä»€éº¼ã€‚</div>';
}

// ============================================================
// PART 6: SubcomposeLayout â€” æ¸¬é‡ä¾è³´è§£æ–¹
// ============================================================
function getPart6() {
  var done = S.completedParts.includes(6);
  var read = S.readParts.includes(6);

  var h = '<div class="part-hdr"><span class="tag">Part 6</span><h1>ğŸ“ SubcomposeLayout â€” æ¸¬é‡ä¾è³´è§£æ–¹</h1>' +
    '<p class="desc">ç•¶ content éœ€è¦çŸ¥é“ topBar çš„é«˜åº¦ä¾†è¨ˆç®— paddingï¼Œä½†å…©è€…å¿…é ˆåœ¨åŒä¸€å€‹ Layout ä¸­æ¸¬é‡â€”â€”SubcomposeLayout å°±æ˜¯è§£æ–¹ã€‚</p></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">å•é¡Œï¼šæ¸¬é‡ä¾è³´</h3>' +
    '<p style="margin-bottom:12px">Scaffold çš„ <code>content</code> éœ€è¦æ¥æ”¶ <code>PaddingValues</code>ï¼Œå…¶ä¸­ <code>top</code> ç­‰æ–¼ topBar çš„é«˜åº¦ã€‚ä½†åœ¨æ™®é€š Layout ä¸­ï¼Œæ‰€æœ‰å­å…ƒä»¶æ˜¯<strong>åŒæ™‚æ¸¬é‡</strong>çš„â€”â€”ä½ ä¸çŸ¥é“ topBar å¤šé«˜å°±æ²’è¾¦æ³•è¨ˆç®— paddingã€‚</p>' +
    '<div class="param-group param-behavior"><strong>æ™®é€š Layout</strong>ï¼šæ‰€æœ‰å­å…ƒä»¶ä¸€æ¬¡æ¸¬é‡ â†’ ç„¡æ³•æ ¹æ“š A çš„çµæœèª¿æ•´ B</div>' +
    '<div class="param-group param-style"><strong>SubcomposeLayout</strong>ï¼šåˆ†æ‰¹æ¸¬é‡ â†’ å…ˆæ¸¬é‡ Aï¼Œå†æ ¹æ“šçµæœæ¸¬é‡ B</div></div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">Scaffold çš„ SubcomposeLayout åˆ†æ‰¹æ¸¬é‡</h3>' +
    codeBlock('SubcomposeLayout { constraints ->\\n    val layoutWidth = constraints.maxWidth\\n    val layoutHeight = constraints.maxHeight\\n    val looseConstraints = constraints.copy(minWidth = 0, minHeight = 0)\\n\\n    // 1. å…ˆæ¸¬é‡ topBar\\n    val topBarPlaceable = subcompose(\\n        ScaffoldLayoutContent.TopBar, topBarContent\\n    ).first().measure(looseConstraints)\\n\\n    // 2. æ¸¬é‡ fab å’Œ snackbar\\n    val fabPlaceable = subcompose(\\n        ScaffoldLayoutContent.Fab, fabContent\\n    ).first().measure(\\n        looseConstraints.offset(-leftInset - rightInset, -bottomInset)\\n    )\\n\\n    // 3. æ¸¬é‡ bottomBar\\n    val bottomBarPlaceable = subcompose(\\n        ScaffoldLayoutContent.BottomBar, bottomBarContent\\n    ).first().measure(looseConstraints)\\n\\n    // 4. è¨ˆç®— contentPadding\\n    contentPadding.paddingHolder = PaddingValues(\\n        top = topBarPlaceable.height.toDp(),\\n        bottom = bottomBarPlaceable.height.toDp(),\\n    )\\n\\n    // 5. æœ€å¾Œæ¸¬é‡ content\\n    val bodyContentPlaceable = subcompose(\\n        ScaffoldLayoutContent.MainContent, bodyContent\\n    ).first().measure(looseConstraints)\\n\\n    layout(layoutWidth, layoutHeight) {\\n        bodyContentPlaceable.place(0, 0)\\n        topBarPlaceable.place(0, 0)\\n        snackbarPlaceable.place(...)\\n        bottomBarPlaceable.place(\\n            0, layoutHeight - bottomBarPlaceable.height\\n        )\\n        fabPlacement?.let {\\n            fabPlaceable.place(\\n                it.left, layoutHeight - fabOffsetFromBottom!!\\n            )\\n        }\\n    }\\n}') +
    '</div>';

  h += '<div class="glass-card"><h3 style="margin-bottom:12px">åˆ†æ‰¹æ¸¬é‡æµç¨‹</h3>' +
    '<div class="layer-diagram">' +
    '<div class="layer-box layer-api">Step 1ï¼šæ¸¬é‡ topBar â†’ å¾—åˆ°é«˜åº¦</div>' +
    '<div class="layer-arrow">â†“</div>' +
    '<div class="layer-box layer-base">Step 2-3ï¼šæ¸¬é‡ fabã€snackbarã€bottomBar</div>' +
    '<div class="layer-arrow">â†“</div>' +
    '<div class="layer-box layer-api">Step 4ï¼šè¨ˆç®— PaddingValuesï¼ˆtop = topBaré«˜åº¦, bottom = bottomBaré«˜åº¦ï¼‰</div>' +
    '<div class="layer-arrow">â†“</div>' +
    '<div class="layer-box layer-base">Step 5ï¼šç”¨ PaddingValues æ¸¬é‡ content</div>' +
    '<div class="layer-arrow">â†“</div>' +
    '<div class="layer-box layer-layout">Step 6ï¼šæŒ‰ç¹ªè£½é †åºæ”¾ç½®æ‰€æœ‰å…ƒä»¶ï¼ˆz-indexï¼‰</div>' +
    '</div></div>';

  h += insightBlock(6, '<code>subcompose()</code> ç”¨ enum keyï¼ˆå¦‚ <code>ScaffoldLayoutContent.TopBar</code>ï¼‰è¿½è¹¤å­å…ƒä»¶ã€‚é€™è®“ Compose èƒ½åœ¨ Recomposition æ™‚æ­£ç¢ºå°æ‡‰èˆŠçš„å­å…ƒä»¶æ¨¹ã€‚ç¹ªè£½é †åºä¹Ÿæœ‰è¬›ç©¶â€”â€”<code>bodyContentPlaceable</code> å…ˆ place æ‰€ä»¥åœ¨æœ€åº•å±¤ï¼Œ<code>topBarPlaceable</code> å¾Œ place æ‰€ä»¥è¦†è“‹åœ¨ä¸Šé¢ï¼Œé€™æ±ºå®šäº† z-indexã€‚');

  if (!read) h += '<div class="read-done"><button class="btn btn-sec" onclick="markRead(6)">âœ“ æˆ‘è®€å®Œäº†ï¼ˆ+50 XPï¼‰</button></div>';
  else h += '<div class="read-done done">âœ“ å·²å®Œæˆé–±è®€</div>';

  var stepLabels = [
    'æ¸¬é‡ topBar',
    'æ¸¬é‡ snackbar å’Œ fab',
    'æ¸¬é‡ bottomBar',
    'è¨ˆç®— contentPadding',
    'æ¸¬é‡ content',
    'æŒ‰ç¹ªè£½é †åºæ”¾ç½®å…ƒä»¶'
  ];

  h += '<div class="quiz-box"><h3>âœ… å°æ¸¬é©—ï¼šScaffold æ¸¬é‡æ­¥é©Ÿæ’åº</h3>' +
    '<p style="color:var(--txt2);font-size:.85rem;margin-bottom:16px">ç”¨ â–² â–¼ æŒ‰éˆ•æŠŠæ­¥é©Ÿæ’æˆæ­£ç¢ºçš„æ¸¬é‡é †åº</p>';
  S.part6Order.forEach(function(idx, pos) {
    h += '<div class="sort-item"><span class="num">' + (pos + 1) + '</span><span class="text">' + stepLabels[idx] + '</span>' +
      (!done ? '<button class="sort-btn" onclick="movePart6(' + pos + ',-1)">â–²</button><button class="sort-btn" onclick="movePart6(' + pos + ',1)">â–¼</button>' : '') +
      '</div>';
  });
  if (!done) h += '<button class="btn btn-pri" onclick="checkQuiz6()" style="margin-top:16px">ç¢ºèªé †åº</button>';
  h += '<div id="quiz6-result"></div>';
  if (done) h += '<div class="quiz-result pass">âœ… å·²é€šéï¼ä½ å·²æŒæ¡ SubcomposeLayout çš„æ¸¬é‡æµç¨‹ã€‚</div>';
  h += '</div>';

  h += briefCard(6, 'SubcomposeLayout', [
    'SubcomposeLayout è§£æ±ºã€Œæ¸¬é‡ä¾è³´ã€å•é¡Œâ€”â€”å…ˆæ¸¬é‡ Aï¼Œå†æ ¹æ“šçµæœæ¸¬é‡ B',
    'Scaffold åˆ† 6 æ­¥ï¼štopBar â†’ fab/snackbar â†’ bottomBar â†’ padding â†’ content â†’ place',
    'subcompose() ç”¨ enum key è¿½è¹¤å­å…ƒä»¶ï¼Œplace é †åºæ±ºå®š z-index'
  ], 'SubcomposeLayout æœ‰æ•ˆèƒ½ä»£åƒ¹å—ï¼Ÿ', 'æœ‰ã€‚subcompose() æ¯æ¬¡éƒ½æœƒé‡æ–°çµ„åˆå­å…ƒä»¶æ¨¹ï¼Œæ¯”æ™®é€š Layout æ›´æ˜‚è²´ã€‚æ‰€ä»¥åªåœ¨çœŸæ­£éœ€è¦ã€Œæ¸¬é‡ä¾è³´ã€æ™‚æ‰ç”¨â€”â€”Scaffold å°±æ˜¯æœ€å…¸å‹çš„å ´æ™¯ã€‚');

  return h;
}

function movePart6(pos, dir) {
  var np = pos + dir;
  if (np < 0 || np >= S.part6Order.length) return;
  var tmp = S.part6Order[pos];
  S.part6Order[pos] = S.part6Order[np];
  S.part6Order[np] = tmp;
  save(); render();
}
function checkQuiz6() {
  var ok = S.part6Order.every(function(v, i) { return v === i; });
  var el = document.getElementById('quiz6-result');
  if (ok) { el.innerHTML = '<div class="quiz-result pass">ğŸ‰ æ’åºæ­£ç¢ºï¼ä½ æŒæ¡äº† Scaffold çš„å®Œæ•´æ¸¬é‡æµç¨‹ã€‚</div>'; completePart(6); }
  else el.innerHTML = '<div class="quiz-result fail">âŒ é †åºä¸å°ã€‚æç¤ºï¼šå…ˆæ¸¬é‡ä¸ä¾è³´å…¶ä»–å…ƒä»¶çš„éƒ¨åˆ†ï¼ˆtopBarï¼‰ï¼Œæœ€å¾Œæ‰æ¸¬é‡éœ€è¦ padding çš„ contentã€‚</div>';
}

// ============================================================
// INIT
// ============================================================
var TOPIC_PARTS = [getPart1, getPart2, getPart3, getPart4, getPart5, getPart6];

document.addEventListener('DOMContentLoaded', function() {
  if (typeof LearningEngine !== 'undefined') {
    LearningEngine.init(TOPIC_CONFIG, TOPIC_PARTS);
  }
});
</script>
</body>
</html>
